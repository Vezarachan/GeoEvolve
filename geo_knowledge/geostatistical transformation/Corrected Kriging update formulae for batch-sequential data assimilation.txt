arXiv:1203.6452v1  [stat.ML]  29 Mar 2012
Corrected Kriging update formulae for batch-sequential
data assimilation
Cl´ement Chevalier∗,
David Ginsbourger†
March 28th, 2012
1
Introduction
Recently, a lot of eﬀort has been paid to the eﬃcient computation of Kriging predictors
when observations are assimilated sequentially. In particular, Kriging update formulae
enabling signiﬁcant computational savings were derived in [1, 3, 2]. Taking advantage
of the previous Kriging mean and variance calculations helps avoiding a costly (n + 1) ×
(n+1) matrix inversion when adding one observation to the n already available ones. In
addition to traditional update formulae taking into account a single new observation, [2]
also proposed formulae for the batch-sequential case, i.e. when r > 1 new observations
are simultaneously assimilated. However, the Kriging variance and covariance formulae
given without proof in [2] for the batch-sequential case are not correct. In this paper
we ﬁx this issue and establish corrected expressions for updated Kriging variances and
covariances when assimilating several observations in parallel.
2
Kriging update formulae for the parallel case
2.1
notations and formulae
In this section we give a counter-example for the Kriging variance update formula pro-
posed in [2]. Let us ﬁrst introduce the notations of this paper and recall these formulae.
When n observations, at locations x1, . . . , xn ∈D, of a real valued random ﬁeld Z in-
dexed by D ⊂Rd are available, [2] denotes respectively by ˆZ(x)n data and σ2
n(x) the
Kriging mean and variance at x ∈D based on these n observations. The corresponding
Kriging covariance is denoted by σn : (x, y) ∈D2 →σn(x, y). If k > 1 new observations,
at points xn+1, . . . , xn+k, are available, the parallel Kriging update formulae given in [2]
∗Institut de Radioprotection et de Sˆuret´e Nucl´eaire (IRSN), Fontenay-aux-Roses, France
†IMSV, Department of Mathematics and Statistics, University of Berne, Switzerland
1

follow:
ˆZ(x)n+k data = ˆZ(x)n data +
k
X
i=1
λn+i|n+k(x)

Z(xn+i) −ˆZ(xn+i)n data

,
(1)
σ2
n+k(x) = σ2
n(x) −
k
X
i=1
λ2
n+i|n+k(x)σ2
n(xn+i) ,
(2)
σn+k(x, y) = σn(x, y) −
k
X
i=1
λn+i|n+k(x)λn+i|n+k(y)σ2
n(xn+i)
(3)
where λn+i|n+k(x) denotes the Kriging weight of Z(xn+i) when predicting Z(x) relying
on n + k observations. In [2], these formulae are proven only for k = 1. For k > 1,
they are quickly justiﬁed with an argument based on Pythagoras’ theorem. In fact, the
assumptions for using this theorem are not satisﬁed, as we will detail here. We now give
a counter-example for Equation (2) and then propose ﬁxed expressions.
2.2
A counterexample for Equation (2)
Let us consider for the sake of simplicity a case where Z is a one-dimensional centered
random process indexed by D = [0, 1], with covariance kernel C(x, y) := σ0(x, y) =
min(x, y) (Wiener process, or Brownian Motion). Note that even though this process
is non-stationary, Simple Kriging equations are applicable to it (Written in the general
case of a non-stationary covariance kernel, as allowed in [2]’s results and notations).
Assuming n = 0 initial observations and k = 2 new observations at the points x1 = 1
2,
x2 = 1, the Kriging weights for a prediction at x = 3
4 write:
(λ1|2(x), λ2|2(x)) = (C(x, x1), C(x, x2))
C(x1, x1)
C(x1, x2)
C(x2, x1)
C(x2, x2)
−1
=
1
2, 1
2

leading to a Kriging mean ˆZ(x)n+k data = 1
2Z(x1) + 1
2Z(x2), and to a Kriging variance:
σ2
2(x) = C(x, x) −(λ1|2(x), λ2|2(x))
C(x1, x1)
C(x1, x2)
C(x2, x1)
C(x2, x2)

(λ1|2(x), λ2|2(x))T = 1
8
Now, using Eq. (2) would lead to
σ2
2(x) = σ2
0(x) −λ2
1|2(x)σ2
0(x1) −λ2
2|2(x)σ2
0(x2)
= 3
4 −1
4
1
2 −1
4 = 3
8
and we see that the two expressions do not match.
More precisely, the conditional
variance obtained by using Eq. (2) is too large, as if the contribution of x1 and x2 to
decreasing the variance would have been underestimated. As we will see now, this is
indeed the case, and the missing part is related to conditional covariances.
2

2.3
Corrected Kriging variance and covariance update formulae
In this section, we establish corrected update formulae that may be used in the batch-
sequential case instead of the formulae (2) and (3). To improve the readability of the
properties and their proofs, we adopt the following simpliﬁed notations:
• Xold := {x1, . . . , xn}, and Xnew := {xn+1, . . . , xn+k},
• Zold := (Z(x1), . . . , Z(xn)), and Znew := (Z(xn+1), . . . , Z(xn+k)),
• λnew,old(x) := (λ1|n+k(x), . . . , λn|n+k(x))T ,
• λnew,new(x) := (λn+1|n+k(x), . . . , λn+k|n+k(x))T ,
• σ2
old(x) := σ2
n(x), σ2
new(x) := σ2
n+k(x), and similarly for the conditional covariances.
• The conditional covariance matrix of Znew knowing Zold is denoted by Σnew,
For conciseness and coherence, ˆZ(x)n data and ˆZ(x)n+k data are also denoted by ˆZ(x)old
and ˆZ(x)new, respectively. The corrected update formulae are given below:
Proposition 1. (Corrected Kriging update equations for the parallel case)
ˆZ(x)new = ˆZ(x)old + λnew,new(x)T (Znew −ˆZ(Xnew)old)
(4)
σ2
new(x) = σ2
old(x) −λnew,new(x)T Σnewλnew,new(x)
(5)
σnew(x, y) = σold(x, y) −λnew,new(x)T Σnewλnew,new(y)
(6)
The proofs above use a Gaussian assumption on the ﬁeld Z, enabling a convenient
interpretation of the Kriging mean and variance in terms of conditional expectation and
variance. A key property is that even though the conditional distribution interpretation
doesn’t hold in non-Gaussian cases, the formulae for the Kriging weights remain valid
whatever the assumed square-integrable distribution for the ﬁeld; we are just using here
that best linear prediction and conditioning coincide in the Gaussian case. Furthermore,
the results hold as well for the cases of Ordinary and Universal Kriging (written in
terms of covariances, for a square-integrable ﬁeld, not with variograms), relying on their
well-known Bayesian construction with an improper prior on the trend coeﬃcient(s).
Proof. The ﬁrst equation follows from an application of the law of total expectation:
ˆZ(x)old = E[Z(x)|Zold]
= E[E[Z(x)|Zold, Znew]|Zold]
= E[λnew,old(x)T Zold + λnew,new(x)T Znew]|Zold]
= λnew,old(x)T Zold + λnew,new(x)T ˆZ(Xnew)old
= λnew,old(x)T Zold + λnew,new(x)T Znew −λnew,new(x)T Znew + λnew,new(x)T ˆZ(Xnew)old
= ˆZ(x)new −λnew,new(x)T (Znew −ˆZ(Xnew)old)
3

Similarly, using the law of total variance delivers:
σ2
old(x) = V ar[Z(x)|Zold]
= E[V ar[Z(x)|Zold, Znew]|Zold] + V ar[E[Z(x)|Zold, Znew]|Zold]
= V ar[Z(x)|Zold, Znew] + V ar[λnew,old(x)T Zold + λnew,new(x)T Znew|Zold]
= σ2
new(x) + λnew,new(x)T Σnewλnew,new(x)
which proves the second equation. The third equation comes with the same method,
using the law of total covariance.
Proposition 2. (Kriging weights expressed in terms of conditional covariance)
Σnewλnew,new(x) = σold(Xnew, x)
(7)
Corollary 1. (Corrected Kriging update equations in terms of conditional covariance)
ˆZ(x)new = ˆZ(x)old + σold(Xnew, x)T Σ−1
new(Znew −ˆZ(Xnew)old)
(8)
σ2
new(x) = σ2
old(x) −σold(Xnew, x)T Σ−1
newσold(Xnew, x)
(9)
σnew(x, y) = σold(x, y) −σold(Xnew, x)T Σ−1
newσold(Xnew, y)
(10)
Proof. Using the orthogonal projection interpretation of the conditional expectation,
Z(x) = E(Z(x)|Zold, Znew) +
=:ε
z
}|
{
Z(x) −E(Z(x)|Zold, Znew)
= λnew,old(x)⊤Zold + λnew,new(x)⊤Znew + ε ,
with ε centered, and independent of Zold and Znew. Let us now calculate the conditional
covariance between Z(x) and Znew knowing the observations Zold:
σold(Xnew, x) := cov(Znew, Z(x)|Zold)
= 0 + cov

Znew, λnew,new(x)⊤Znew
 Zold

+ cov(Znew, ε|Zold)
=Σnewλnew,new(x) + cov(ε, Znew|Zold)
Noting that cov(Znew, ε|Zold) = 0, the latter equation proves Proposition 2. Eqs. 8, 9,
and 9 of the corollary directly follow by plugging in Eq. 2 into Eqs. 4, 5, 6.
2.4
Interpretation on the counter-example
The main diﬀerence between Equations 2 and 5 is that Eq. 5 takes into account condi-
tional Kriging covariances. Coming back to the counter example, Eq. 5 delivers:
σ2
2(x) = σ2
0(x) −λ2
1|2(x)σ2
0(x1) −λ2
2|2(x)σ2
0(x2)−2λ1|2(x)λ2|2(x)σ0(x1, x2)
= 3
4 −1
4
1
2 −1
4 −21
4
1
2 = 1
8
4

which is the correct variance, as obtained earlier with regular Simple Kriging equations.
Note that Eq. 2 would be correct if the matrix Σnew were diagonal, which has no par-
ticular reason to happen in practical applications. The Pytagorean theorem invoked in
[2], enabling to decompose a variance into a sum of (weighted) variances, cannot hence
be applied in the general case because of non-independence between Kriging residuals.
3
Conclusion
In this paper we derived corrected Kriging update formulae, ﬁxing the incorrect formu-
lae 2 and 3 given in [2], where a part of the update involving conditional covariances
had been neglected. A simple interpretation of the new update formulae is that they
correspond to Simple Kriging equations, where the underling covariance kernel would
be the conditional covariance kernel before update, i.e σold(., .). These formulae enable
important computational savings (avoiding a large matrix inversion) and may perfectly
be adapted to further frameworks such as co-Kriging.
Acknowledgements: The authors would like to thank Dr. Julien Bect (Ecole Sup´erieure
d’Electricit´e) for drawing their attention to the conditional covariance interpretation of
Kriging weights in the non-parallel case. Cl´ement Chevalier acknowledges support from
IRSN and the ReDICE consortium. David Ginsbourger acknowledges support from the
IMSV, University of Berne.
References
[1] R. J. Barnes and A. Watson. Eﬃcient updating of Kriging estimates and variances.
Mathematical geology, 24(1):129–133, 1992.
[2] X. Emery. The Kriging update equations and their application to the selection of
neighboring data. Computational Geosciences, 13(1):211–219, 2009.
[3] H. Gao, J. Wang, and P. Zhao. The updated Kriging variance and optimal sample
design. Mathematical Geology, 28:295–313, 1996.
5
