Spatial Conformal Inference through Localized Quantile Regression
Hanyang Jiang, Yao Xie
Dec 2023
Abstract
Reliable uncertainty quantification at unobserved spatial locations, particularly for complex
and heterogeneous datasets, is a key challenge in spatial statistics. Traditional methods like
Kriging rely on assumptions such as normality, which often fail in large-scale datasets, leading
to unreliable intervals. Machine learning methods focus on point predictions but lack robust
uncertainty quantification. Conformal prediction provides distribution-free prediction intervals
but often assumes i.i.d. data, which is unrealistic for spatial settings. We propose Localized
Spatial Conformal Prediction (LSCP), designed specifically for spatial data. LSCP uses localized
quantile regression and avoids i.i.d. assumptions, instead relying on stationarity and spatial
mixing, with finite-sample and asymptotic conditional coverage guarantees. Experiments on
synthetic and real-world data show that LSCP achieves accurate coverage with tighter, more
consistent prediction intervals than existing methods.
1
Introduction
Quantifying uncertainty at unobserved spatial locations has been a longstanding challenge in spatial
statistics, particularly in practical applications such as weather forecasting (Siddique et al., 2022)
and mobile signal coverage estimation (Jiang et al., 2024). Traditional methods like Kriging rely on
strong parametric assumptions, including normality and stationarity, to model spatial relationships
and quantify uncertainty (Cressie, 2015). However, the failure of these assumptions in the complex
spatial datasets (Heaton et al., 2019) results in unreliable uncertainty quantification. The issue is
especially pronounced when constructing prediction intervals, as deviations from stationarity or
Gaussianity can critically undermine their validity (Fuglstad et al., 2015).
While many methods have been developed to handle heterogeneity (Gelfand et al., 2005; Duan
et al., 2007), these approaches are often computationally expensive and cannot scale effectively
for massive datasets. Furthermore, fully modeling the underlying process is not always necessary,
particularly when the goal is to produce reliable prediction intervals. Recently, machine learning
approaches have offered alternative strategies for spatial prediction (Hengl et al., 2018; Chen
et al., 2020), though they tend to focus on point predictions and often lack rigorous uncertainty
quantification.
Conformal prediction, introduced by (Vovk et al., 2005), provides a powerful, distribution-
free approach to uncertainty quantification. Its ability to generate valid prediction sets without
assumption on the underlying data distribution and the prediction model has gained widespread
popularity in both machine learning and statistics (Lei & Wasserman, 2014; Angelopoulos et al.,
2023). By leveraging only the exchangeability of data, conformal prediction ensures valid coverage
at any significance level, making it highly attractive for scenarios where a black-box model is used,
or traditional parametric assumptions may fail.
1
arXiv:2412.01098v2  [stat.ML]  16 Feb 2025

However, in many real-world datasetsâ€”such as time-series dataâ€”the assumption of exchange-
ability does not hold. To address this, recent work has extended conformal prediction to handle
non-exchangeable data. For instance, (Tibshirani et al., 2019) introduced weighted quantiles to
maintain valid coverage in the presence of distributional shifts between training and test sets by
leveraging the likelihood ratio between distributions. More recently, (Barber et al., 2023) tackled
the challenge of distribution shifts by bounding the coverage gap using the total variation distance,
although the issue of optimizing these weights remains open. For time-series data, further improve-
ments have been made in tightening prediction intervals and building theoretical guarantees, as
demonstrated by (Xu & Xie, 2023; Xu et al., 2024).
In this paper, we extend conformal prediction to spatial data, where the assumption of ex-
changeability rarely holds. While time-series data can be viewed as a special case of spatial data
defined in a one-dimensional time domain, spatial data is inherently multidimensional and poses
unique challenges. For example, while time indices are typically discrete and naturally ordered,
spatial locations are continuous and lack intrinsic ordering. Despite the prevalence of spatial data
in real-world applications, there has been limited work on conformal prediction methods tailored
to this context. To address this gap, we propose Localized Spatial Conformal Prediction (LSCP),
a novel conformal prediction method that employs localized quantile regression for constructing
prediction intervals. Our method and theoretical framework can also be extended to spatio-temporal
settings, broadening its applicability. Here is a revised version of the summary:
â€¢ Localized Spatial Conformal Prediction (LSCP): We introduce LSCP, a conformal prediction
algorithm specifically designed for spatial data, which utilizes localized quantile regression to
construct prediction intervals.
â€¢ Theoretical guarantees: We establish a finite-sample bound for the coverage gap and provide
asymptotic convergence guarantees for LSCP, without requiring the exchangeability of the
data.
â€¢ Numerical Evaluation: We extensively evaluate LSCP against state-of-the-art conformal
prediction methods using both synthetic and real-world datasets.
The results highlight
LSCPâ€™s ability to achieve tighter prediction intervals with valid coverage and more consistent
performance across the spatial domain.
1.1
Literature
Conformal prediction beyond exchangeability.
Traditional conformal prediction relies on the as-
sumption of i.i.d. or exchangeability, which is often difficult to satisfy in real-world datasets. Recent
research has focused on extending methods and theoretical frameworks to non-exchangeable data
to broaden applicability. A prominent approach is weighted conformal prediction, which assigns
greater importance to samples deemed more â€reliable.â€ The work from (Tibshirani et al., 2019)
explored the covariate shift scenario, where the distribution of features X differs between calibration
and test data, while the conditional distribution Y |X remains unchanged. They demonstrated
that weighting samples by the ratio of the distributions restores exchangeability. Building on this,
(Barber et al., 2023) proposed a general weighted conformal framework and provided an analysis
of the coverage gap in the general non-exchangeable setting, offering insights into the relationship
between the weights and the coverage gap.
Conformal prediction for time series.
One key application of conformal prediction in non-exchangeable
settings is time-series data. Some studies (Gibbs & Candes, 2021; Zaffran et al., 2022) have focused
2

on adaptively adjusting the significance level Î± over time to achieve valid coverage. Another
work (Angelopoulos et al., 2024), built upon the idea of control theory, prospectively model the
non-conformity scores in an online setting. Another line of research (Tibshirani et al., 2019; Xu
et al., 2024) follows the concept of weighted conformal prediction by assigning higher weights to
more recent data points. The choice of the weights plays a critical role in determining the empirical
performance of the method. However, as noted by (Barber et al., 2023), no universally optimal
weighting strategy has been found, leaving room for further exploration and optimization in this area.
Without exchangeability in the time series setting, the finite-sample guarantee does not necessarily
hold, and asymptotic coverage can be achieved instead with certain additional assumptions.
Conformal prediction for spatial data.
The spatial setting represents a broader and more complex
domain compared to time-series data, yet research on conformal prediction for spatial contexts
remains limited. A recent study by (Mao et al., 2024) introduced a spatial conformal prediction
method under the infill sampling framework, where data density increases within a bounded region.
The key finding is that for spatial data, the exact or asymptotic exchangeability holds in certain
settings. The algorithm falls within the category of weighted conformal prediction, employing
kernel functions such as the radial basis function (RBF) kernel as weights. Similarly, (Guan, 2023)
proposed a general localized framework for conformal prediction. While not explicitly designed
for spatial data, their method also advocates using kernel functions for weighting, highlighting its
potential relevance in spatial applications.
2
Problem setup
In this paper, we consider a spatial setting with observations {Z(si)}n
i=1, where Z(s) = (X(si), Y (si))
represents a random field observed at a finite set of spatial locations si. Here, Y (s) âˆˆR denotes
the response variable, and X(s) âˆˆRp is the associated feature vector. The feature vector X(s) can
include any relevant information that is useful for predicting Y (s), such as spatial location s. Unlike
the time series setting, where observations are indexed by fixed times t, the spatial setting considers
the locations s as random variables sampled from a distribution g(s), while allowing for potential
dependency within the random field Z(s).
In the context of conformal prediction, the objective is to construct a prediction region
Ë†Cn(X(sn+1)) for an unobserved response Y (sn+1) given a known feature vector X(sn+1). For
a user-specified confidence level Î±, we aim to ensure that the probability of Y (sn+1) falling within
the prediction region exceeds 1âˆ’Î±. This notion of coverage can be interpreted in two ways: marginal
coverage and conditional coverage. Marginal coverage is defined as
P(Y (sn+1) âˆˆË†Cn(X(sn+1))) â‰¥1 âˆ’Î±,
whereas conditional coverage requires that
P(Y (sn+1) âˆˆË†Cn(X(sn+1)) | X(sn+1)) â‰¥1 âˆ’Î±.
Conditional coverage is a stronger condition than marginal coverage as it requires valid coverage for
different X(s). However, as shown by (Foygel Barber et al., 2021), achieving conditional coverage
universally is impossible without making additional assumptions about the data distribution. In
traditional conformal prediction settings, where data points are assumed to be i.i.d. or exchangeable,
only marginal coverage is typically guaranteed. Besides valid coverage, constructing a prediction
region that is as narrow as possible is desirable to improve the empirical performance of conformal
prediction. The whole space is an example of a trivial prediction set, but it is too large to be useful
and informative.
3

Exchangeability
(ğœ€1, â‹¯, ğœ€ğ‘›) = (ğœ€ğœ1 , â‹¯, ğœ€ğœğ‘›)
ğ‘‘
(ğœ€(ğ‘ 1), â‹¯, ğœ€(ğ‘ ğ‘›)) = (ğœ€(ğ‘ 1 + ğ›¿), â‹¯, ğœ€(ğ‘ ğ‘›+ ğ›¿)), âˆ€ğ›¿
Spatial Stationarity
ğ‘‘
Figure 1: Difference between exchangeability and spatial stationarity.
3
Method
3.1
Background: Conformal prediction
conformal prediction is a widely used technique for constructing prediction intervals with finite-
sample guarantees under minimal assumptions. The method is designed to provide a prediction
interval for a response variable Yn+1 associated with a new feature vector Xn+1, given a predictive
model Ë†f and a set of observations {(Xi, Yi)}n
i=1. The data is divided into two disjoint sets: a training
set used to fit the model Ë†f, and a calibration set used to calculate non-conformity scores, which
quantify the uncertainty of the model at each point. A common choice for non-conformity score is
Ë†Îµi = |Yi âˆ’Ë†f(Xi)|, which measures how well the model prediction aligns with the observed response.
There is no restriction on the choice of the non-conformity score.
To construct a prediction interval for Yn+1, the empirical quantile of the non-conformity scores
Ë†Qn from the calibration set is used as the estimate. Specifically, for a user-specified confidence level
1 âˆ’Î±, the prediction interval is defined as
Ë†Cn(Xn+1) =
h
Ë†f(Xn+1) âˆ’Ë†Qn(1 âˆ’Î±), Ë†f(Xn+1) + Ë†Qn(1 âˆ’Î±)
i
.
The empirical quantile can be written explicitly as
Ë†Qn(p) = inf{e âˆˆR :
n
X
i=1
1
n1{Ë†Îµ(si) â‰¤e} â‰¤p}.
Utilizing the exchangeability of the data, the method provides a prediction interval with valid
marginal coverage, ensuring that Yn+1 falls within the interval with probability at least 1 âˆ’Î±.
Besides the strong theoretical guarantee, conformal prediction is appealing due to its flexibility in
the prediction model, as it has no assumptions about the underlying distribution of Y or the form
of the model Ë†f.
Classical geostatistical methods like Gaussian Process (GP) assume that any finite set of
observations has a joint Gaussian distribution. Given data, it provides both mean prediction and
uncertainty estimates for unseen points, making it suitable for regression tasks where probabilistic
predictions are desirable. In contrast to conformal prediction, which constructs prediction intervals
by assessing model residuals without assumptions on data distribution, GPs rely on a Gaussian
prior and explicit covariance structure. While conformal prediction provides finite-sample coverage
guarantees under minimal assumptions, GPs often lose coverage when data does not satisfy the
Gaussian assumption. Furthermore, it is computationally expensive to learn a GP model, which
makes it difficult for GP to utilize as much data as possible. This also weakens the performance of
GP. On the contrary, conformal prediction is computationally efficient and can be used with any
prediction model.
4

3.2
Proposed method: Local spatial conformal prediction (LSCP)
In spatial settings, data often exhibit significant dependence across locations, and taking the spatial
dependence into account can improve the accuracy of prediction intervals. To account for this, it is
advantageous to base predictions on nearby data points, as spatially proximate observations are
likely to share similar distributions and therefore provide more reliable information. The recent
study by (Barber et al., 2023) highlights the importance of weighting calibration data differently,
depending on their relevance to the target prediction point.
To construct the prediction interval, we first split the dataset into a training set and a cal-
ibration set.
The training set is used to train the prediction model Ë†f, while the calibration
set decides the width of the interval.
We assume the calibration set consists of observations
(X(s1), Y (s1)), . . . , (X(sn), Y (sn)). For a new observation (X(sn+1), Y (sn+1)), the aim is to con-
struct a prediction interval by selecting a neighborhood of data from the calibration data. Here we
use N(sn+1) to represent all the indices i so that si is in the neighborhood of sn+1. The neighborhood
can be determined via various criteria, and a common approach is to include all nearby points
located within a specified distance threshold. In the paper, we use k-nearest neighbor for simplicity.
Given the trained model Ë†f, the non-conformity scores are defined as Ë†Îµ(si) = Y (si) âˆ’Ë†f(X(si)).
We then define the conditional cumulative distribution function (CDF) for the non-conformity scores
based on the selected neighbors, denoted by
F(e|{Ë†Îµ(si)}iâˆˆN(sn+1)) = P(Ë†Îµ(sn+1) â‰¤e|{Ë†Îµ(si)}iâˆˆN(sn+1)).
The conditional quantile Qn(p) is defined as
Qn(p) = inf{e âˆˆR : F(e|{Ë†Îµ(si)}iâˆˆN(sn+1)) â‰¥p}.
The empirical quantile places an equal weight on all the points, which may not fully capture
the dependence structure. Instead, we apply a quantile regression estimator bQn on the residuals
{Ë†Îµ(si)}iâˆˆN(sn+1).
The estimator, bQn(Î±), predicts the Î±-quantile of the residual Ë†Îµ(sn+1) given
the values of its neighbors. For computational efficiency, we use Quantile Random Forests from
(Meinshausen & Ridgeway, 2006), although other quantile regression techniques could also be applied.
The resulting prediction interval is:
Ë†Cn(X(sn+1)) = [ Ë†f(X(sn+1)) + bQn(Î²âˆ—), Ë†f(X(sn+1)) + bQn(1 âˆ’Î± + Î²âˆ—)],
where Î²âˆ—= argminÎ²âˆˆ[0,Î±]( bQn(1 âˆ’Î± + Î²) âˆ’bQn(Î²)). Here Î² is optimized to find the tightest interval.
To formalize this approach, let ËœX(si) = (Ë†Îµ(sj))jâˆˆN(si) and ËœY (si) = Ë†Îµ(si). The quantile regression,
which learns the conditional quantile of F( ËœY (sn+1)| ËœX(sn+1)), computes:
bQn(p) = inf{e âˆˆR :
X
iâˆˆN(sn+1)
Ï‰i1{ ËœY (si) â‰¤e} â‰¤p},
where the weights Ï‰i are learned through quantile regression.
3.3
Comparison with related methods
3.3.1
Global Spatial Conformal Prediction
Global Spatial Conformal Prediction (GSCP), introduced in (Mao et al., 2024), applies equal
weighting to all non-conformity scores across the calibration dataset, where the non-conformity
score is defined as
Ë†Îµ(si) =

Yi âˆ’Ë†f(si, X(si))
Ë†Ïƒ(si, X(si))
 .
5

sparse
dense
Æ¸ğœ€(ğ‘ 2)
Æ¸ğœ€(ğ‘ 4)
Æ¸ğœ€(ğ‘ 1)
Æ¸ğœ€(ğ‘ 5)
Æ¸ğœ€(ğ‘ 3)
ğœ”1
ğœ”2
ğœ”3
ğœ”4
ğœ”5
Æ¸ğœ€(ğ‘ )
neighboring points
test point
Figure 2: Illustration of Localized Spatial Conformal Prediction (LSCP). Left: k-nearest neighbors
with weights predict test points and quantify uncertainty. Right: Neighborhoods adapt to dense
and sparse regions. Red points mark test locations, dashed circles show 5-nearest neighbors, and
darker grey indicates lower uncertainty. LSCP uses neighbors to construct prediction intervals.
Algorithm 1 Spatial Conformal Prediction
Require: Dataset {(x(si), y(si))}n
i=1, prediction algorithm A, significance level Î±
Ensure: Prediction intervals { bCn (x(sn+1))}
1: Split the dataset into training data and calibration data.
2: Train the prediction model Ë†f with the training data using the prediction algorithm A.
3: Select the neighborhood of sn+1 in the calibration data, denoted as N(sn+1).
4: Compute the non-conformity scores Ë†Îµ(si) = Y (si) âˆ’Ë†f(X(si)) for all data in the calibration set.
5: Set ËœY (si) = Ë†Îµ(si) and
6: ËœX(si) = (Ë†Îµ(sj1), . . . , Ë†Îµ(sj|N(si)|)), where sj âˆˆN(si).
7: Fit quantile regression bQn with all pairs ( ËœX(si), ËœY (si)) in the calibration data.
8: Obtain the prediction interval Ë†Cn(X(sn+1)).
The estimated quantile at any point is given by
Ë†Qn(p) = inf{e âˆˆR : 1
n
n
X
i=1
1{Ë†Îµ(si) â‰¤e} â‰¤p}.
(1)
The method can be viewed as an extension of split conformal prediction. Its primary advantage
is the strong theoretical guarantee, achieved with minimal assumptions. When the spatial locations
are sampled i.i.d. from a common distribution FÎµ(s), the data becomes exchangeable because
switching the order does not change the joint probability. The marginal coverage automatically
holds in this situation.
However, in real-world applications, the performance of global conformal methods like GSCP may
be limited because data distributions can vary across locations. Unfortunately, the exchangeability
does not hold for localized methods. Since GSCP lacks adaptivity to different locations, it tends
to construct intervals that may be overly conservative to meet the marginal coverage requirement,
leading to overcoverage in some regions.
6

3.3.2
Smoothed Local Spatial CP
Smoothed Local Spatial Conformal Prediction (SLSCP) (Mao et al., 2024) improves upon previous
GSCP by utilizing only nearby data to construct prediction intervals. The non-conformity scores
are defined as in Equation 1, but the quantile is estimated locally:
Ë†Qn(p) = inf{e âˆˆR :
X
iâˆˆN(sn+1)
Ï‰i1{ ËœY (si) â‰¤e} â‰¤p}.
(2)
A key difference between our method and SLSCP is in the choice of weights Ï‰i.
In SLSCP,
Ï‰i âˆk(âˆ¥si âˆ’sn+1âˆ¥), where k is a kernel function that depends solely on the distance between spatial
locations. In contrast, our method learns Ï‰i through quantile regression based on features ËœX(s).
This feature vector can contain additional information beyond spatial distance, allowing the learned
weights to be more expressive and adaptive than a given kernel function. The numerical results in
Section 5 demonstrate that our method significantly outperforms SLSCP in experiments.
Another key distinction lies in the theoretical foundations. Conditional on the location sn+1, the
asymptotic coverage of SLSCP depends on an infill sampling assumption, where data points become
infinitely dense around sn+1, requiring infinitely close data. Additionally, SLSCP assumes the data
process to be a composition of an L2-continuous spatial process and a locally i.i.d. noise process
Îµ(s). Under these assumptions, the process can be shown to be locally asymptotically exchangeable,
achieving asymptotic coverage as data points accumulate around the test location.
In contrast, our method establishes a finite-sample bound for the conditional coverage gap of
LSCP, which guarantees asymptotic coverage. A key distinction is that our result conditions on
the feature X(sn+1), rather than solely on the location sn+1, making it more general and broadly
applicable. We assume an additive data model with a stationary, spatially mixing error process
rather than an i.i.d. process. Spatial mixing implies that dependence between data points diminishes
with increasing distance. Instead of requiring infinitely close neighbors, we assume that the average
dependence decreases as more neighbors are included. The assumption is reasonable in that, given
a fixed dataset, selecting more neighbors for prediction increases the neighborhood size, leading to a
natural decay in correlation as more distant neighbors are included. Furthermore, our setting can be
extended to spatio-temporal settings, which are commonly encountered in real-world applications.
In contrast, SLSCP cannot generalize to time-series data or similar scenarios, as the time index
cannot become infinitely dense, as required by the infill sampling assumption.
3.3.3
Localized Conformal Prediction
Localized Conformal Prediction (LCP), introduced in (Guan, 2023), provides a general framework
for localized conformal prediction rather than the spatial setting only. The method combines GSCP
and SLSCP in quantile estimation:
Ë†Qn(p) = inf{e âˆˆR :
n
X
i=1
Ï‰i1{ ËœY (si) â‰¤e} â‰¤p}.
(3)
Similar to GSCP, LCP uses all calibration data for prediction, but like SLSCP, it applies weights
to each data point. The weights are defined as Ï‰i âˆk(X(si), X(sn+1)), where k is a user-specified
kernel function measuring similarity between features. The choice allows for more flexibility than the
location-based weights in SLSCP, as feature-based weights can capture more detailed information.
However, LCP still relies on user-specified weights, meaning the chosen kernel function might not
fully capture the dependence structure in the data.
7

Table 1: Comparison of assumptions and algorithms of three related localized conformal prediction
methods.
LSCP (Ours)
SLSCP (Mao et al., 2024)
LCP (Guan, 2023)
Algorithm
localized weighted quantile
localized weighted quantile
global weighted quantile
Weights
learned by quantile regression
parametric kernel for location s
parametric kernel for feature X(s)
Distributional
assumption
stationary and spatial mixing
noise Îµ(s)
locally i.i.d. noise Îµ(s)
globally i.i.d. data (X(s), Y (s))
Data model
additive noise
continuous mapping from L2-continuous
spatial and noise processes
no assumption
In terms of theoretical assumptions, LCP assumes that the data {(Xi, Yi)}n
i=1 are i.i.d., which
ensures finite-sample marginal coverage. The assumption is stronger than all the other methods,
which hinders the generality of the result.
4
Theoretical results
4.1
Setting
Suppose the data is denoted by {Z(si)}n
i=1, where Z(s) = (X(s), Y (s)), s âˆˆRd denotes the spatial
location, X(s) âˆˆRd is the feature vector and Y (s) âˆˆR represents the univariate response. We
assume that Y (s) is generated from a true model with unknown additive noise:
Y (s) = f(X(s)) + Îµ(s),
where f is an unknown function and Îµ(s) represents the noise process, whose marginal distribution
is not necessarily Gaussian. Given a pre-trained prediction model Ë†f, we can compute the non-
conformity scores
Ë†Îµ(s) = Y (s) âˆ’Ë†f(X(s)).
The estimated conditional distribution function bF(Îµ|x) is defined as
bF(Îµ|x) =
n
X
i=1
wt(x)1(Ë†Îµ(si) â‰¤Îµ).
Besides, we define the weighted empirical CDF as
eF(Îµ|x) =
n
X
i=1
wt(x)1(Îµ(si) â‰¤Îµ).
4.2
Preliminary
Stochastic Design: Random observation location.
The key distinction between time series and
spatial data lies in the indexing of observations. For time series data, observations are indexed by
a fixed, ordered sequence of time points, denoted as (Xt, Yt). This inherent ordering imposes a
natural temporal structure, preventing data points from being exchangeable. In contrast, spatial
data are indexed by locations that can be irregularly distributed across space, with each data point
in a random field represented as (X(s), Y (s)), where s denotes a spatial location. In stochastic
design, the spatial locations s are considered random, following some underlying distribution. If
8

we further assume that the locations of both calibration and test data are independently sampled
from the same underlying distribution, then exchangeability holds naturally. In this case, marginal
coverage is guaranteed for global conformal prediction that constructs prediction region with the
whole calibration dataset, as established in (Mao et al., 2024). However, this does not apply in
time series contexts due to the fixed temporal order, making it impossible to freely exchange data
points. In a spatial setting, local conformal methods violate this exchangeability assumption because
they apply different weights or restrictions based on proximity. As a result, while global conformal
methods achieve exchangeability and marginal coverage, local conformal methods require additional
conditions to maintain validity. Interestingly, we can consider time series as a special case of spatial
data by restricting the spatial domain to a single dimension and treating time as a scalar spatial
index. In this case, each time point can be thought of as a distinct â€œlocationâ€ on a one-dimensional
grid, with the locations ordered sequentially. This perspective highlights that time series analysis is
a subset of spatial analysis, albeit with the added constraint of temporal ordering.
Spatial mixing.
Next, we define the strong mixing co-efficient for random field Z(Â·). Let FZ(T) =
ÏƒâŸ¨Z(s) : s âˆˆTâŸ©be the Ïƒ-field generated by the variables {Z(s) : s âˆˆT}, T âŠ‚Rd. For any two subsets
T1 and T2 of Rd, let ËœÎ± (T1, T2) = sup {|P(A âˆ©B) âˆ’PAPB| : A âˆˆFZ (T1) ,
B âˆˆFZ (T2)}, and let
d (T1, T2) = inf {|x âˆ’s| : x âˆˆT1,
s âˆˆT2}. For d = 1, we define the strong mixing co-efficient as
Î±(a; b) = sup{ËœÎ±((x âˆ’b, x], [y, y + b)) : âˆ’âˆ< x + a < y < âˆ},
a > 0, b > 0.
Thus, Î±(a; âˆ) corresponds to the standard strong mixing co-efficient commonly used in the time
series case. To define the strong mixing co-efficient for d â‰¥2, let Rk(b) â‰¡
n
âˆªk
i=1Di : Pk
i=1 |Di| â‰¤b
o
be the collection of all disjoint unions of k cubes D1, . . . , Dk in Rd, k â‰¥1, b > 0. Following the
definition in (Lahiri, 2003), the strong-mixing coefficient for the r.f. Z(Â·) for d â‰¥2 is defined as
Î±(a; b) = sup {ËœÎ± (T1, T2) : d (T1, T2) â‰¥a, T1, T2 âˆˆR3(b)} .
To simplify the exposition, we further assume that there exists a nonincreasing function Î±1(Â·)
with limaâ†’âˆÎ±1(a) = 0 and a nondecreasing function g(Â·) such that the strong-mixing coefficients
Î±(a, b) satisfies the inequality
Î±(a, b) â‰¤Î±1(a)g(b),
a > 0, b > 0,
(4)
where the function g(Â·) is bounded for d = 1 but may be unbounded for d â‰¥2. Without loss of
generality, we may assume that Î±1(Â·) is left continuous and g(Â·) is right continuous (otherwise,
replace Î±1(a) by Î±1(aâˆ’) â‰¥Î±1(a) and g(b) by g(b+) â‰¥g(b)). We shall specify exact conditions on
the rate of decay of Î±1(Â·) and the growth rate of g(Â·) in the statements of the results below.
4.3
Assumptions
With the data (X(s1), Y (s1)), Â· Â· Â· , (X(sn), Y (sn)), we would like to construct a prediction region for
Y (sn+1) where only the feature X(sn+1) is known. Define Ï‰n(X(si)) to be the normalized weight
over samples s1, Â· Â· Â· , sn so that Pn
i=1 Ï‰n(X(si)) = 1. The weight function can be some function
that measures the similarity between X(s) and X(sn+1).
Assumption 4.1 (Weight decay). There exists Î³ > 0 so that the normalized weights satisfy
Ï‰n(X(si)) = o(nâˆ’1+Î³
2 ),
(5)
for all i; meaning that Mn = max1â‰¤iâ‰¤n Ï‰n(X(si)) = o(nâˆ’1+Î³
2 ).
9

The requirement assumes that the normalized weights decay at a rate faster than nâˆ’1
2 . As we
can see, Ï‰n = 1
n is a special case that satisfies this condition. The condition is also weaker than the
requirement of Ï‰n = O( 1
n) in a related study (Xu et al., 2024). Besides, the assumption can also be
inferred from that of SLSCP (Mao et al., 2024) where a GBF kernel with infinitely close data leads
to uniform weights.
Assumption 4.2 (Estimation quality). There exists a sequence {Î´n}nâ‰¥1 such that
n
X
i=1
âˆ¥Ë†Îµ(si) âˆ’Îµ(si)âˆ¥2 â‰¤Î´2
n
Mn
,
âˆ¥Ë†Îµ(sn+1) âˆ’Îµ(sn+1)âˆ¥â‰¤Î´n.
(6)
The assumption requires that the average prediction error be bounded by a term Î´2
n, which is a
weaker requirement than the similar condition for bounding the average prediction error in (Xu &
Xie, 2021). The reason lies in that Mn is allowed to decay at a slower rate than 1
n. Notably, our
result of the coverage gap does not require Î´n to converge to zero. However, there are many cases
where Î´n does indeed approach zero. For instance, extensive research has investigated the prediction
error of neural networks. Under certain regularization conditions on f, (Barron, 1994) shows that
Î´n = O

1
âˆšn

.
Assumption 4.3 (Stationary and spatial mixing). The random field Îµ(s) is stationary and strongly
mixing with coefficient Î±. The strong mixing coefficient can be bounded by Î±(a, b) â‰¤Î±1(a)g(b), where
Î±1 is a nonincreasing function with limaâ†’âˆÎ±1(a) = 0. We assume Edâˆ¼gnÎ±1(d)2 â‰¤M
n2 where gn(d)
is distribution of the distance between two sample points si and sj (1 â‰¤i, j â‰¤n). Besides, FÎµ(x)
(the CDF of the true non-conformity score) is assumed to be Lipschitz continuous with constant
Ln+1 > 0.
The requirement assumes that the true error Îµ(s) is spatially stationary and strongly mixing,
a condition weaker than the i.i.d. assumption used in (Mao et al., 2024) for spatial conformal
prediction. Under this assumption, the original random field {X(s), Y (s)} can still exhibit complex
dependencies and be highly non-stationary. Here b is a constant in the definition of spatial mixing,
which can be any specified positive integer. The assumption further requires that the expectation of
the mixing coefficient Î±1(d) decays at a certain rate. The decay is reasonable in that a bigger n
implies sampling from a larger area, thereby increasing the average distance between calibration
points. The assumption is analogous to a common condition in time series analysis, which requires
the sum of strong mixing coefficients to be bounded. To sum up, this assumption indicates that
dependence between data points diminishes as distance increases.
4.4
Coverage guarantee
With the assumptions, we can show that the distance between the empirical CDF of the residuals
Ë†
Îµ(s) and the noise Îµ(s) can actually be bounded through Lemma 4.4
Lemma 4.4 (Distance between the empirical CDF of Îµ and Ë†Îµ). Under Assumption 4.1 and 4.2,
sup
x | bFn+1(y) âˆ’eFn+1(y)| â‰¤(Ln+1 + 1)Î´n + 2 sup
y | eFn+1(y) âˆ’FÎµ(y)|.
(7)
Besides, we can also prove that the empirical CDF of the noise Îµ(s) converges to its CDF with a
high probability.
10

Lemma 4.5 (Convergence of empirical CDF of Îµ). Under Assumptions 4.1-4.3, with probability
higher than 1 âˆ’(2 + M + 2
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 ,
sup
y
 eFn+1(y) âˆ’FÏµ(y)
 â‰¤Mnn
1+Î³
2 ,
(8)
where eFn+1(y) = Pn
i=1 Ï‰n(X(si))1(Ïµ(si) â‰¤y).
Our main theorem is the following: Using the previous lemma, we establish the asymptotic
convergence of conditional coverage.
Theorem 4.6 (Conditional coverage guarantee). Under Assumption 4.1-4.3, for any Î± âˆˆ(0, 1) and
sample size T, we have
P

Y (sn+1) âˆˆbCtâˆ’1 (X(sn+1)) | X(sn+1)

âˆ’(1 âˆ’Î±)

â‰¤4Ln+1Î´n + 6Mnn
1+Î³
2
+ (4 + 2M + 4
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 .
(9)
We can establish the same result for marginal coverage with the tower law property.
Corollary 4.7 (Marginal Coverage). Under Assumption 4.1-4.3, for any Î± âˆˆ(0, 1) and sample size
T, we have
P

Y (sn+1) âˆˆbCtâˆ’1 (X(sn+1))

âˆ’(1 âˆ’Î±)

â‰¤4Ln+1Î´n + 6Mnn
1+Î³
2
+ (4 + 2M + 4
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 .
(10)
From Inequality 9, we can see that the order of the coverage bound is controlled by Mnn
1+Î³
2
and
nâˆ’2Î³
3 (log2 n + 2)
4
3 . The first term is equal to n
Î³âˆ’1
2
in the special case of Mn = 1
n and the second
term diminishes when n is large enough because n is of higher order than log2 n. As long as the
estimation gap Î´n goes to zero when n gets larger, the asymptotic conditional coverage can be
inferred from the main theorem.
5
Experiments
In this section, we compare our proposed LSCP method against four baseline approaches. The first
method, EnbPI (Xu & Xie, 2021), is designed for time series data and applies equal weight to the
most recent observations. The second method, GSCP (Mao et al., 2024), uses the entire dataset
for prediction, applying equal weights to all data points. The third method, SLSCP (Mao et al.,
2024), leverages k-nearest neighbors for uncertainty quantification, assigning different weights to
each point based on the spatial distance between the test data and the calibration data. The fourth
method, LCP (Guan, 2023), utilizes all data points for prediction, weighting them according to the
similarity between the features of test data and calibration data. Both SLSCP and LCP use the
Gaussian kernel as a similarity measure.
We randomly split the dataset into three subsets: 40% for training, 40% for calibration, and
20% for testing. For each method and dataset, the number of neighbors and the Gaussian kernel
bandwidth are selected through 5-fold cross-validation.
11

Scenario 1
(a) Coverage
(b) Width
Scenario 2
(c) Coverage
(d) Width
Scenario 3
(e) Coverage
(f) Width
New Mexico
(g) Coverage
(h) Width
Georgia
(i) Coverage
(j) Width
Figure 3: The violin plots on the left show the distribution of coverage across different areas, while
the plots on the right show the distribution of width. Each row represents a different scenario or
location.
12

Scenario 1
Scenario 2
Scenario 3
(a) Residual
(b) LSCP
(c) EnbPI
(d) SLSCP
(e) LCP
Figure 4: The heatmaps illustrate the width of the prediction intervals for each method across
the three scenarios. The width heatmap of LSCP closely matches the true residual heatmap,
demonstrating its ability to capture fine details accurately.
5.1
Synthetic data experiments
We begin by comparing LSCP with baseline methods across several simulated scenarios. For
simplicity, we assume that the locations s are uniformly sampled from the unit grid [0, 1] Ã— [0, 1].
The mean-zero stationary Gaussian process X(s) is defined using a MatÂ´ern covariance function with
variance Ïƒ2 = 1, range Ï• = 0.1, and smoothness Îº = 0.7. The scenarios are as follows:
1. Y (s) = X(s) + Ïµ(s).
2. Y (s) = X(s)|Ïµ(s)|.
3. Y (s) = X(s) + sin(âˆ¥sâˆ¥2)Ïµ(s).
These scenarios incorporate nonlinear and non-stationary settings that extend beyond the
assumptions of our theoretical framework. Nevertheless, the empirical results demonstrate that
LSCP consistently outperforms other methods across all scenarios.
In Table 2, LSCP achieves the target coverage of 90% across all cases while maintaining
significantly narrower prediction intervals. Figure 4 visualizes the interval width over the spatial
domain for each scenario and the true residuals. GSCP is omitted from these plots as it produces
uniform interval widths across space. A larger interval width indicates higher model uncertainty.
The results show that LSCP adapts more locally, whereas the other methods exhibit smoother, more
uniform patterns. Both EnbPI and SLSCP rely on k-nearest neighbors for constructing prediction
intervals, differing primarily in their weighting schemes.
To evaluate the methods, we divide the grid into 10Ã—10 areas and compute coverage and average
interval width for each, as shown in Figure 3. Both LSCP and GSCP achieve average coverage
13

Table 2: Simulation: The table presents a comparison of the coverage and prediction interval width
for five methods across three scenarios. Target coverage is 90%.
Method
S1 Coverage
S1 Width
S2 Coverage
S2 Width
S3 Coverage
S3 Width
LSCP
92%
1.44
90.4%
0.64
91.3%
0.97
EnbPI
88.5%
1.83
89.2%
0.75
86.2%
1.12
GSCP
89.4%
1.92
89.7%
0.77
89.6%
1.30
SLSCP
90.6%
1.64
88.2%
0.73
89.1%
1.07
LCP
89.6%
1.92
94.1%
0.78
91.8%
1.43
Table 3: Real data: The table presents a comparison of the coverage and prediction interval width
for five methods on mobile signal data. The target coverage is 90%.
Method
NM Coverage
NM Width
GA coverage
GA width
LSCP
92.6%
211.3
90.6%
130.8
EnbPI
88.4%
272.2
88.6%
166.3
GSCP
90.1%
295.9
89.2%
167.3
SLSCP
89.8%
276.8
89.6%
167.8
LCP
89.7%
266.4
89.3%
166.7
above the target 90%, with LSCP exhibiting the most stable and consistent distribution. LSCP also
attains the smallest interval width and the highest consistency. LCP performs similarly to GSCP, as
both utilize the entire calibration dataset, and as kernel bandwidth increases, LCP weights converge
to GSCPâ€™s uniform weights. Overall, LSCP produces tighter valid regions with superior consistency.
5.2
Real data experiments
In the real-data experiments, we utilize mobile network measurement data from the Ookla public
dataset, which records user-reported statewide mobile internet performance. Our analysis focuses on
datasets from New Mexico and Georgia. The data is unevenly distributed across urban and suburban
areas. We employ kernel regression as the prediction method Ë†f and compare the performance
of conformal methods. The New Mexico dataset contains 24,983 observations, while the Georgia
dataset includes 28,587 data points.
As shown in Table 3, our proposed LSCP method outperforms competing methods by achieving
significantly narrower prediction intervals while maintaining better coverage. Similar to the synthetic
experiments, we divide each state into 10 Ã— 10 grids and compute coverage and interval width for
the test data within each grid. The violin plots in Figure 3 illustrate the grid-level distribution of
these metrics, highlighting spatial performance. Unlike the table, which reports averages over all
test points, the plots emphasize spatial consistency, showing higher coverage in urban areas due to
denser data.
The results demonstrate that LSCP consistently achieves high coverage with narrow, uniform
intervals, outperforming alternative methods.
The violin plots confirm LSCPâ€™s stability and
uniformity across the spatial domain, underscoring its robustness to non-uniform data distributions.
These findings align with our synthetic study, further validating LSCPâ€™s effectiveness in diverse and
complex settings.
14

6
Conclusion
This paper introduces the Localized Spatial Conformal Prediction (LSCP) method, which addresses
key limitations in spatial and spatio-temporal prediction for non-exchangeable data. Traditional
methods, such as Kriging, often depend on strong parametric assumptions that may not hold in
complex real-world scenarios, including heterogeneous or large-scale spatial datasets. While machine
learning techniques offer flexibility and predictive power, they typically lack robust uncertainty
quantification, which is critical for applications requiring reliable decision-making.
Our results show that LSCP significantly outperforms existing methods, including GSCP, SLSCP,
and EnbPI, by achieving more accurate coverage and narrower prediction intervals. This advantage
is particularly pronounced in scenarios with non-stationary and non-Gaussian data, where LSCPâ€™s
flexibility enables it to effectively handle such complexities. Moreover, LSCPâ€™s theoretical framework
supports extension to spatio-temporal settings where exchangeability is unlikely to hold.
In synthetic experiments, LSCP consistently meets the target coverage with narrower intervals,
even in cases beyond its assumptions, demonstrating robustness across diverse scenarios. Real-world
experiments further validate LSCPâ€™s utility, showing that it generates detailed uncertainty maps
with tighter intervals than baseline methods. These features underscore LSCPâ€™s potential as a
reliable and scalable tool for spatial uncertainty quantification, offering both theoretical guarantees
and practical performance benefits.
References
Angelopoulos, A., Candes, E., and Tibshirani, R. J. Conformal pid control for time series prediction.
Advances in neural information processing systems, 36, 2024.
Angelopoulos, A. N., Bates, S., et al. Conformal prediction: A gentle introduction. Foundations
and TrendsÂ® in Machine Learning, 16(4):494â€“591, 2023.
Barber, R. F., Candes, E. J., Ramdas, A., and Tibshirani, R. J. Conformal prediction beyond
exchangeability. The Annals of Statistics, 51(2):816â€“845, 2023.
Barron, A. R. Approximation and estimation bounds for artificial neural networks. Machine learning,
14:115â€“133, 1994.
Chen, W., Li, Y., Reich, B. J., and Sun, Y. Deepkriging: Spatially dependent deep neural networks
for spatial prediction. arXiv preprint arXiv:2007.11972, 2020.
Cressie, N. Statistics for spatial data. John Wiley & Sons, 2015.
Duan, J. A., Guindani, M., and Gelfand, A. E.
Generalized spatial dirichlet process models.
Biometrika, 94(4):809â€“825, 2007.
Foygel Barber, R., Candes, E. J., Ramdas, A., and Tibshirani, R. J. The limits of distribution-free
conditional predictive inference. Information and Inference: A Journal of the IMA, 10(2):455â€“482,
2021.
Fuglstad, G.-A., Simpson, D., Lindgren, F., and Rue, H. Does non-stationary spatial data always
require non-stationary random fields? Spatial Statistics, 14:505â€“531, 2015.
Gelfand, A. E., Kottas, A., and MacEachern, S. N. Bayesian nonparametric spatial modeling with
dirichlet process mixing. Journal of the American Statistical Association, 100(471):1021â€“1035,
2005.
15

Gibbs, I. and Candes, E. Adaptive conformal inference under distribution shift. Advances in Neural
Information Processing Systems, 34:1660â€“1672, 2021.
Guan, L. Localized conformal prediction: A generalized inference framework for conformal prediction.
Biometrika, 110(1):33â€“50, 2023.
Heaton, M. J., Datta, A., Finley, A. O., Furrer, R., Guinness, J., Guhaniyogi, R., Gerber, F.,
Gramacy, R. B., Hammerling, D., Katzfuss, M., et al. A case study competition among methods
for analyzing large spatial data. Journal of Agricultural, Biological and Environmental Statistics,
24:398â€“425, 2019.
Hengl, T., Nussbaum, M., Wright, M. N., Heuvelink, G. B., and GrÂ¨aler, B. Random forest as a
generic framework for predictive modeling of spatial and spatio-temporal variables. PeerJ, 6:
e5518, 2018.
Jiang, H., Belding, E., Zegure, E., and Xie, Y. Learning cellular network connection quality with
conformal. arXiv preprint arXiv:2407.10976, 2024.
Lahiri, S. N. Central limit theorems for weighted sums of a spatial process under a class of stochastic
and fixed designs. SankhyÂ¯a: The Indian Journal of Statistics, pp. 356â€“388, 2003.
Lei, J. and Wasserman, L. Distribution-free prediction bands for non-parametric regression. Journal
of the Royal Statistical Society Series B: Statistical Methodology, 76(1):71â€“96, 2014.
Mao, H., Martin, R., and Reich, B. J. Valid model-free spatial prediction. Journal of the American
Statistical Association, 119(546):904â€“914, 2024.
Meinshausen, N. and Ridgeway, G. Quantile regression forests. Journal of machine learning research,
7(6), 2006.
Rio, E. et al. Asymptotic theory of weakly dependent random processes, volume 80. Springer, 2017.
Siddique, T., Mahmud, M. S., Keesee, A. M., Ngwira, C. M., and Connor, H. A survey of uncertainty
quantification in machine learning for space weather prediction. Geosciences, 12(1):27, 2022.
Tibshirani, R. J., Foygel Barber, R., Candes, E., and Ramdas, A. Conformal prediction under
covariate shift. Advances in neural information processing systems, 32, 2019.
Vovk, V., Gammerman, A., and Shafer, G. Algorithmic learning in a random world, volume 29.
Springer, 2005.
Xu, C. and Xie, Y.
Conformal prediction interval for dynamic time-series.
In International
Conference on Machine Learning, pp. 11559â€“11569. PMLR, 2021.
Xu, C. and Xie, Y. Sequential predictive conformal inference for time series. In International
Conference on Machine Learning, pp. 38707â€“38727. PMLR, 2023.
Xu, C., Jiang, H., and Xie, Y. Conformal prediction for multi-dimensional time series by ellipsoidal
sets. arXiv preprint arXiv:2403.03850, 2024.
Zaffran, M., FÂ´eron, O., Goude, Y., Josse, J., and Dieuleveut, A. Adaptive conformal predictions for
time series. In International Conference on Machine Learning, pp. 25834â€“25866. PMLR, 2022.
16

A
Proofs
In our spatial conformal prediction method, the weight function is defined as Ï‰n. The weighted
empirical distribution for the true noise Îµ is
ËœFn+1(y) =
n
X
i=1
Ï‰n(X(si))1(Îµ(si) â‰¤y).
(1)
Here Ï‰n is the normalized weight. Besides, we also define the weighted empirical distribution for
the residual Ë†Îµ as
bFn+1(y) =
n
X
i=1
Ï‰n(X(si))1(Ë†Îµ(si) â‰¤y).
(2)
We assume an additive true model which is commonly used in literature like (Xu & Xie, 2021):
Y (s) = f(X(s)) + Îµ(s).
(3)
Considering that the residual is Ë†Îµ(s) = Y (s) âˆ’Ë†f(X(s)), it follows
Îµ(s) = Ë†f(X(s)) âˆ’f(X(s)),
(4)
which is the prediction error.
The following Lemma bounds the distance between the weighted empirical distribution for the
residual and true error.
Lemma A.1. Under Assumption 4.2 and 4.1,
sup
x | bFn+1(y) âˆ’eFn+1(y)| â‰¤(Ln+1 + 1)Î´n + 2 sup
y | eFn+1(y) âˆ’FÎµ(y)|.
(5)
Proof. Using Assumption 4.2, we have that
n
X
i=1
Ï‰n(X(si))|Îµ(si) âˆ’Ë†Îµ(si)| â‰¤Mn
n
X
i=1
|Îµ(si) âˆ’Ë†Îµ(si)| â‰¤Î´2
n.
(6)
Let S = {t : |Îµ(si) âˆ’Ë†Îµ(si)| â‰¥Î´n}. Then
Î´n
X
iâˆˆS
Ï‰n(X(si)) â‰¤
n
X
i=1
Ï‰n(X(si))|Îµ(si) âˆ’Ë†Îµ(si)| â‰¤Î´2
n.
(7)
So P
iâˆˆS Ï‰n(X(si)) â‰¤Î´n. Then
| bFn+1(y) âˆ’eFn+1(y)| â‰¤
n
X
i=1
Ï‰n(X(si))|1{Ë†Îµ(si) â‰¤y} âˆ’1{Îµ(si) â‰¤y}|
â‰¤
n
X
i=1
Ï‰n(X(si)) +
X
i/âˆˆS
Ï‰n(X(si))|1{Ë†Îµ(si) â‰¤y} âˆ’1{Îµ(si) â‰¤y}|
(i)
â‰¤
n
X
i=1
Ï‰n(X(si)) +
X
i/âˆˆS
Ï‰n(X(si))1{|Îµ(si) âˆ’y| â‰¤Î´n}
â‰¤
n
X
i=1
Ï‰n(X(si)) +
n
X
i=1
Ï‰n(X(si))1{|Îµ(si) âˆ’y| â‰¤Î´n}
17

â‰¤Î´n + P(|Îµ(sn+1) âˆ’y| â‰¤Î´n)+
sup
y

n
X
i=1
Ï‰n(X(si))1{|Îµ(si) âˆ’y| â‰¤Î´n} âˆ’P(|Îµ(sn+1) âˆ’y| â‰¤Î´n)

= Î´n + [FÎµ(y + Î´n) âˆ’FÎµ(y âˆ’Î´n)] + sup
y
[ eFn+1(y + Î´n) âˆ’eFn+1(y âˆ’Î´n)]
âˆ’[FÎµ(y + Î´n) âˆ’FÎµ(y âˆ’Î´n)]

(ii)
â‰¤(Ln+1 + 1)Î´n + 2 sup
y | eFn+1(y) âˆ’FÎµ(y)|,
where (i) is because |1{a â‰¤y} âˆ’1{b â‰¤y}| â‰¤1{|b âˆ’y| â‰¤|a âˆ’b|} for a, b âˆˆR and (ii) is because
the Lipschitz continuity of FÎµ(y).
Lemma A.2. Under assumption 4.1-4.3, with probability higher than 1 âˆ’Mnâˆ’2Î³
3 (log2 n+2)
4
3 ,
E

sup
y | ËœFn+1(y) âˆ’FÎµ(y)|2

â‰¤(2 + log2 n)2
n
(1 + 2
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 ),
(8)
where Î± = .
Proof. Define Zn+1(y) = ËœFn+1(y)âˆ’FÎµ(y). Besides, we also define Zn+1(A) = Pn
i=1 Ï‰n(X(si))1(X(si) âˆˆ
A) âˆ’FÎµ(Îµ âˆˆA), where A can be any region. Let N be some positive integer to be chosen later. We
first represent the CDF FÎµ(x) in base 2:
FÎµ(x) =
N
X
i=1
bi(x)2âˆ’i + rN(x),
(9)
where rN(x) âˆˆ[0, 2âˆ’N) and bi = 0 or 1.
For l âˆˆ{1, 2, Â· Â· Â· , N}, define
Bl(x) =
l
X
i=1
bi(x)2âˆ’i.
(10)
We can define the points xi where FÎµ(xi) = Bi(x). We have that
FÎµ(x) âˆ’FÎµ(xi) =
N
X
i=l+1
ai(x)2âˆ’i + rN(x) â‰¤2âˆ’l.
(11)
As a result, we can partition Zn+1(x) into the following sum:
Zn+1(F âˆ’1
Îµ
(x)) = Zn+1(F âˆ’1
Îµ
(B1(x))) +
Nâˆ’1
X
i=1
(Zn+1(F âˆ’1
Îµ
(Bi+1(x))) âˆ’Zn+1(F âˆ’1
Îµ
(Bi(x))))
+ (Zn+1(F âˆ’1
Îµ
(y)) âˆ’Zn+1(F âˆ’1
Îµ
(BN(x)))).
(12)
In order to bound Zn+1(y), we can bound each individual term instead. Since Bi+1(x) âˆ’Bi(x) =
bi+1(x)2âˆ’(i+1) â‰¤2âˆ’(i+1), we know the interval [Bi(x), Bi+1(x)] either has zero length, or it is equal
to one region in the set {[(j âˆ’1)2âˆ’(i+1), j2âˆ’(i+1)], 1 â‰¤j â‰¤2i+1}. As a result, we have
|Zn+1(F âˆ’1
Îµ
(Bi+1(x)))âˆ’Zn+1(F âˆ’1
Îµ
(Bi(x)))| â‰¤
sup
jâˆˆ[1,2i+1]
|Zn+1(F âˆ’1
Îµ
(j2âˆ’(i+1))) âˆ’Zn+1(F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)))|
(13)
18

Let
Î´i =
sup
jâˆˆ[1,2i+1]
|Zn+1([F âˆ’1
Îµ
(j2âˆ’(i+1)), F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1))])|,
and
Î´xN = sup
x |Zn+1([F âˆ’1
Îµ
(BN(x)), x])|.
It follows that
|Zn+1(F âˆ’1
Îµ
(y))| â‰¤
N
X
i=1
Î´i + Î´xN.
(14)
By the triangle inequality,
(E( sup
yâˆˆ[0,1]
|Zn+1(F âˆ’1
Îµ
(y))|2))1/2 â‰¤
N
X
i=1
(EÎ´2
i )1/2 + (EÎ´2
xN)1/2.
(15)
Then we need to bound âˆ¥Î´iâˆ¥2 and âˆ¥Î´xNâˆ¥2 separately. Since Î´i is computing the supremum over
a set, it can be bounded by the sum over the set,
Î´2
i â‰¤
2i
X
j=1
(Zn+1(F âˆ’1
Îµ
(j2âˆ’(i+1))) âˆ’Zn+1(F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)))2.
(16)
Taking expectation, we have
EÎ´2
i â‰¤
2i
X
j=1
E(Zn+1(F âˆ’1
Îµ
(j2âˆ’(i+1))) âˆ’Zn+1(F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)))2
=
2i
X
j=1
Var(Zn+1([F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)), F âˆ’1
Îµ
(j2âˆ’(i+1))])).
(17)
Let (Ïµi)i>0 be a sequence of independent and symmetric random variables in {âˆ’1, 1}. For any
finite partition A1, Â· Â· Â· , Ak of R,
k
X
j=1
Var Zn+1(Aj) = E(Z2
n+1(
k
X
j=1
Ïµi1Ai))
(i)
â‰¤M2
n(n + 2
X
1â‰¤i<jâ‰¤n
Î±ij),
(18)
where Î±ij = Î±(Ïƒ(Îµ(si)), Ïƒ(Îµ(sj))) is the alpha-mixing coefficient, Mn = max1â‰¤iâ‰¤n Ï‰n(X(si)) and (i)
is because of Lemma 1.1 in (Rio et al., 2017).
Because of Assumption 4.3, we have
E
X
1â‰¤i<jâ‰¤n
Î±ij â‰¤E
X
1â‰¤i<jâ‰¤n
Î±1(|si âˆ’sj|)g(b)
â‰¤n
s
E
X
1â‰¤i<jâ‰¤n
Î±2
1(|si âˆ’sj|)g(b)
â‰¤n2q
Edâˆ¼gnÎ±2
1(d)g(b) â‰¤n
âˆš
Mg(b),
(19)
19

where gn is the distribution of the distance between si and sj for any i, j âˆˆ{1, Â· Â· Â· , n}.
Besides, using Cauchy-Schwarz inequality, the variance can be bounded by
Var
X
1â‰¤i<jâ‰¤n
Î±ij = E
ï£«
ï£­
X
1â‰¤i<jâ‰¤n
Î±ij
ï£¶
ï£¸
2
âˆ’
ï£«
ï£­E
X
1â‰¤i<jâ‰¤n
Î±ij
ï£¶
ï£¸
2
â‰¤E
ï£«
ï£­
X
1â‰¤i<jâ‰¤n
Î±ij
ï£¶
ï£¸
2
â‰¤n2E
ï£«
ï£­
X
1â‰¤i<jâ‰¤n
Î±2
ij
ï£¶
ï£¸
â‰¤n2M.
(20)
From Markov inequality, we know that for any k > 0,
P
ï£«
ï£­1
n

X
1â‰¤i<jâ‰¤n
Î±ij âˆ’E
X
1â‰¤i<jâ‰¤n
Î±ij

â‰¥k
ï£¶
ï£¸â‰¤
Var P
1â‰¤i<jâ‰¤n Î±ij
n2k2
â‰¤M
k2 .
(21)
Let k = n
Î³
3 (log2 n + 2)âˆ’2
3 , using Inequality 21, with probability higher than 1 âˆ’Mnâˆ’2Î³
3 (log2 n +
2)
4
3 ,
1
n
X
1â‰¤i<jâ‰¤n
Î±ij â‰¤
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 .
(22)
Because [F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)), F âˆ’1
Îµ
(j2âˆ’(i+1))] for j = 1, Â· Â· Â· , 2i+1 is a partition of R, from 18 and
22,
EÎ´2
i â‰¤
2i
X
j=1
Var(Zn+1([F âˆ’1
Îµ
((j âˆ’1)2âˆ’(i+1)), F âˆ’1
Îµ
(j2âˆ’(i+1))]))
â‰¤nM2
n(1 + 2
âˆš
Mg(b) + 2n
Î³
3 (log2 n + 2)âˆ’2
3 ).
(23)
For the other term Î´xN, we know x = F âˆ’1
Îµ
(FÎµ(x)) â‰¤F âˆ’1
Îµ
(BN(x) + rN(x)). We have
Zn+1([F âˆ’1
Îµ
(BN(x)), x]) = ËœFn+1([F âˆ’1
Îµ
(BN(x)), x]) âˆ’FÎµ([F âˆ’1
Îµ
(BN(x)), x])
â‰¥âˆ’FÎµ([F âˆ’1
Îµ
(BN(x)), x])
= BN(x) âˆ’x â‰¥âˆ’2âˆ’N.
(24)
On the other hand,
Zn+1([F âˆ’1
Îµ
(BN(x)), x]) = Zn+1([F âˆ’1
Îµ
(BN(x)), BN(x)) + 2âˆ’N]) âˆ’Zn+1([F âˆ’1
Îµ
(x, BN(x)) + 2âˆ’N])
â‰¤Zn+1([F âˆ’1
Îµ
(BN(x)), BN(x)) + 2âˆ’N]) + 2âˆ’N.
(25)
As a result, we have
Î´xN â‰¤Î´N + 2âˆ’N.
(26)
20

To sum up, we prove that
(E( sup
yâˆˆ[0,1]
|Zn+1(F âˆ’1
Îµ
(y))|2))
1
2 â‰¤n
1
2 Mn(N + 1 + 2âˆ’N)(1 + 2
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 )
1
2 .
(27)
Let N = log2 n, we have
E( sup
yâˆˆ[0,1]
|Zn+1(F âˆ’1
Îµ
(y))|2) â‰¤M2
nn(2 + log2 n)2(1 + 2
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 ).
(28)
Corollary A.3. Under Assumptions 4.1-4.3, with probability higher than 1âˆ’(2+M+2
âˆš
Mg(b))nâˆ’2Î³
3
(log2 n + 2)
4
3 ,
sup
y
 eFn+1(y) âˆ’FÏµ(y)
 â‰¤Mnn
1+Î³
2 ,
(29)
where eFn+1(y) = Pn
i=1 Ï‰n(X(si))1(Ïµ(si) â‰¤y).
Proof. We have that
ËœFn+1(y) âˆ’FÏµ(y) =
n
X
i=1
Ï‰n(X(si))1(Ïµ(si) â‰¤y) âˆ’FÏµ(y)
=
n
X
i=1
Ï‰n(X(si))(1(Ïµ(si) â‰¤y) âˆ’FÏµ(y)).
(30)
Let Z(si) = 1(Ïµ(si) â‰¤y) âˆ’FÏµ(y), we know
EZ(si) = 0,
(31)
and Z(s) is stationary. From Lemma A.2, using Markov inequality, we have that for any k,
P(sup
y | ËœFn+1(y) âˆ’FÎµ(y)| â‰¥k) â‰¤E(supy | ËœFn+1(y) âˆ’FÎµ(y)|2)
k2
= M2
nn(2 + log2 n)2(1 + 2
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 )
k2
.
(32)
Let k = Mnn
1+Î³
2 , we have
P

sup
y | ËœFn+1(y) âˆ’FÎµ(y)| â‰¥Mnn
1+Î³
2

â‰¤(2 + log2 n)2nâˆ’Î³(1 + 2
âˆš
Mg(b) + n
Î³
3 (log2 n + 2)âˆ’2
3 )
= (1 + 2
âˆš
Mg(b))(2 + log2 n)2nâˆ’Î³ + (2 + log2 n)
4
3 nâˆ’2Î³
3
â‰¤(2 + 2
âˆš
Mg(b))(2 + log2 n)
4
3 nâˆ’2Î³
3 .
(33)
The last inequality holds because the order of log2n is smaller than n
Î³
3 .
Theorem A.4. Under Assumption 4.1-4.3, for any Î± âˆˆ(0, 1) and sample size T, we have
P

Y (sn+1) âˆˆbCtâˆ’1 (X(sn+1)) | X(sn+1) = X(sn+1)

âˆ’(1 âˆ’Î±)

â‰¤4Ln+1Î´n + 6Mnn
1+Î³
2
+ (4 + 2M + 4
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 .
(34)
21

Proof. For simplicity, we use Xi = X(si), Yi = Y (si), Îµi = Îµ(si) and Ï‰ni = Ï‰n(X(si)). For any
Î² âˆˆ[0, 1],
P

Yn+1 âˆˆbCtâˆ’1 (Xn+1) | Xn+1

âˆ’(1 âˆ’Î±)

=
P

Îµn+1 âˆˆ[ bQÎ²âˆ—(Xn+1), bQ1âˆ’Î±+Î²âˆ—(Xn+1)] | Xn+1

âˆ’(1 âˆ’Î±)

=
P
 
Î² â‰¤
n
X
i=1
Ï‰ni1(Ë†Îµi â‰¤Ë†Îµn+1) â‰¤1 âˆ’Î± + Î²
!
âˆ’(1 âˆ’Î±)

=
P

Î² â‰¤bFn+1(Ë†Îµn+1) â‰¤1 âˆ’Î± + Î²

âˆ’P (Î² â‰¤FÎµ(Îµn+1) â‰¤1 âˆ’Î± + Î²)

â‰¤E
1{Î² â‰¤bFn+1(Ë†Îµn+1) â‰¤1 âˆ’Î± + Î²} âˆ’1{Î² â‰¤FÎµ(Îµn+1) â‰¤1 âˆ’Î± + Î²}

(i)
â‰¤E
 1{Î² â‰¤bFn+1(Ë†Îµn+1)} âˆ’1{Î² â‰¤FÎµ(Îµn+1)}

+
1{ bFn+1(Ë†Îµn+1) â‰¤1 âˆ’Î± + Î²} âˆ’1{FÎµ(Îµn+1) â‰¤1 âˆ’Î± + Î²}


(ii)
â‰¤P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)


+ P

|FÎµ(Îµn+1) âˆ’(1 âˆ’Î± + Î²)| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)


,
(35)
where Inequality (i) follows since for any constants a, b and univariates x, y, | 1{a â‰¤x â‰¤
b} âˆ’1{a â‰¤y â‰¤b}| â‰¤|1{a â‰¤x} âˆ’1{a â‰¤y}| + |1{x â‰¤b} âˆ’1{y â‰¤b}|. On the other hand, Inequality
(ii) is a result of |1{a â‰¤x} âˆ’1{b â‰¤x}| â‰¤1{|b âˆ’x| â‰¤|a âˆ’b|}. Using Lemma A.2,
P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)


â‰¤P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)
 , sup
y
FÎµ(y) âˆ’bFn+1(y)
 â‰¤Mnn
1+Î³
2

+ P

sup
y
FÎµ(y) âˆ’bFn+1(y)
 â‰¥Mnn
1+Î³
2

â‰¤P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)
 | sup
y
FÎµ(y) âˆ’bFn+1(y)
 â‰¤Mnn
1+Î³
2

+ (2 + M + 2
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3
â‰¤P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤|FÎµ(Îµn+1) âˆ’FÎµ(Ë†Îµn+1)| + (Ln+1 + 1)Î´n + 3Mnn
1+Î³
2

+ (2 + M + 2
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3
â‰¤P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤Ln+1 |Îµn+1 âˆ’Ë†Îµn+1| + (Ln+1 + 1)Î´n + 3Mnn
1+Î³
2

+ (2 + M + 2
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3
â‰¤2Ln+1Î´n + 3Mnn
1+Î³
2
+ (2 + M + 2
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 .
(36)
The inequality above also holds for P

|FÎµ(Îµn+1) âˆ’Î²| â‰¤
FÎµ(Îµn+1) âˆ’bFn+1(Ë†Îµn+1)


, so
P

Yn+1 âˆˆbCtâˆ’1 (Xn+1) | Xn+1

âˆ’(1 âˆ’Î±)

â‰¤4Ln+1Î´n + 6Mnn
1+Î³
2
+ (4 + 2M + 4
âˆš
Mg(b))nâˆ’2Î³
3 (log2 n + 2)
4
3 .
(37)
22
