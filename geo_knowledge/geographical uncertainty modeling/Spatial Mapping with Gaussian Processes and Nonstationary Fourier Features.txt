Spatial Mapping with Gaussian Processes and
Nonstationary Fourier Features
Jean-Francois Ton1, Seth Flaxman2, Dino Sejdinovic1, and Samir Bhatt3,*
1Department of Statistics, University of Oxford, Oxford, OX1 3LB, UK
2Department of Mathematics and Data Science Institute, Imperial College London, London, SW7 2AZ, UK
3Department of Infectious Disease Epidemiology, Imperial College London, London, W2 1PG, UK
*Corresponding author: bhattsamir@gmail.com
Abstract
The use of covariance kernels is ubiquitous in the field of spatial statistics. Kernels
allow data to be mapped into high-dimensional feature spaces and can thus extend simple
linear additive methods to nonlinear methods with higher order interactions. However, until
recently, there has been a strong reliance on a limited class of stationary kernels such as the
Mat´ern or squared exponential, limiting the expressiveness of these modelling approaches.
Recent machine learning research has focused on spectral representations to model arbitrary
stationary kernels and introduced more general representations that include classes of
nonstationary kernels. In this paper, we exploit the connections between Fourier feature
representations, Gaussian processes and neural networks to generalise previous approaches
and develop a simple and efficient framework to learn arbitrarily complex nonstationary
kernel functions directly from the data, while taking care to avoid overfitting using state-
of-the-art methods from deep learning. We highlight the very broad array of kernel classes
that could be created within this framework. We apply this to a time series dataset and a
remote sensing problem involving land surface temperature in Eastern Africa. We show that
without increasing the computational or storage complexity, nonstationary kernels can be
used to improve generalisation performance and provide more interpretable results.
arXiv:1711.05615v1  [stat.ML]  15 Nov 2017

1
Introduction
The past decade has seen a tremendous and ubiquitous growth in both data collection and
computational resources available for data analysis. In particular, spatiotemporal modelling has
been brought to the forefront with applications in finance [1], weather forecasting [2], remote
sensing [3–5] and demographic/disease mapping [6–8]. The methodological workhorse of mapping
efforts has been Gaussian process (GP) regression [9,10]. The reliance on GPs stems from their
convenient mathematical framework which allows the modelling of distributions over nonlinear
functions. GPs offer robustness to overfitting, a principled way to integrate over hyperparameters,
and provide uncertainty intervals. In a GP, every point in some continuous input space is
associated with a normally distributed random variable, such that every finite collection of
those random variables has a multivariate normal distribution – entirely defined through a
mean function µ(·) and a covariance kernel function k(·, ·). In many settings, µ(·) = 0 and
modelling proceeds through selecting the appropriate kernel function which entirely determines
the properties of the GP, and can have a significant influence on both the predictive performance
and on the model interpretability [11, 12]. However, in practice, the kernel function is often
(somewhat arbitrarily) set a priori to the squared exponential or Mat´ern class of kernels [12],
justifying this choice by the fact that they model a rich class of functions [13].
While offering an elegant mathematical framework, performing inference with GP models is
computationally demanding. Namely, evaluating the GP posterior involves a matrix inversion,
which for n observations, requires O(n3) time and O(n2) storage complexity. This makes
fitting full GP models prohibitive for any dataset that exceeds a few thousand observations
(thereby limiting their use exactly in the regimes where a flexible nonlinear model is of interest).
In response to these limitations, many scalable approximations to GP modelling have been
proposed. Examples include inducing points representations [14], the Nystr¨om approximation [9],
the Fully Independent Training Conditional (FITC) model [15], stochastic partial differential
equation representations [16], and representations in the Fourier domain [17–19]. Most of these
approaches reduce the computational complexity to O(nm2) time and O(nm) storage for m ≪n
playing the role of the number of dimensions of the functional space under consideration (e.g.
the number of inducing points or the number of frequencies in Fourier representations).

In this contribution, we will focus on large-scale Fourier representations of GPs. These methods
traditionally rely on the strong assumption of the stationarity (or shift-invariance) of kernel
functions, which is made in the vast majority of applications (and is indeed satisfied by the
most often used squared exponential and Mat´ern kernels). Stationarity in the spatio-temporal
data means that the similarity between two responses in space and time does not depend on the
location and time itself, but only on the difference (or lag) between them, i.e. kernel function
can be written as k(x1, x2) = κ(x1 −x2) for some function κ. Several recent works [18,20,21]
consider flexible families of kernels based on Fourier representations, thus avoiding the need to
choose a specific kernel a priori and allowing the kernel to be learned from the data, but these
approaches are restricted to the stationary case. In many applications, particularly when data is
rich, relaxing the assumption of stationarity can greatly improve generalisation performance [11].
To address this, recent work in [12, 19] note that a more general spectral characterisation
exists that includes nonstationary kernels [12,22] and uses it to construct nonstationary kernel
families. In this paper, we build on the work of [18,19,23] and develop a simple and practicable
framework for learning spatiotemporal nonstationary kernel functions directly from the data
by exploiting the connections between Fourier feature representations, Gaussian processes and
neural networks [9]. Specifically, we directly learn frequencies in nonstationary spectral kernel
representations using an appropriate neural network architecture, and adopt techniques used
for deep learning regularisation [24] to prevent overfitting. We demonstrate the utility of the
proposed method for learning nonstationary kernel functions in a time series example and in
spatial mapping of land surface temperature in East Africa.
2
Methods and Theory
2.1
Gaussian Process Regression
Gaussian process regression (GPR) takes a training dataset D = {(xi, yi)}n
i=1 where yi ∈R is
real-valued response/output and xi ∈RD is a D-dimensional input vector. The response yi and
the input xi are connected via the observation model
yi = f(xi) + ϵi,
ϵi
i.i.d.
∼N(0, σ2
n),
i = 1, . . . , n.
(1)

GPR is a Bayesian non-parametric approach that imposes a prior distribution on functions f,
namely a GP prior, such that any vector f = [f(x1), .., f(xm)] of a finite number of evaluations
of f follows a multivariate normal distribution f ∼N(0, Kxx), where the covariance matrix
Kxx is created as a Gram matrix based on the kernel function evaluations, [Kxx]ij = k(xi, xj).
Throughout this paper we will assume that the mean function of the GP prior is µ = 0,
however, all the approaches in this paper can be easily extended to include a mean function [25].
In stationary settings, k(xi, xj) = κ(xi −xj) for some function κ(δ). A popular choice is
the automatic relevance determination (ARD) kernel [9], given by κ(δ) = τ 2 exp(−δ⊤Λδ)
where τ 2 > 0 and Λ = diag(λ1, . . . , λD). Kernel k will typically have hyperparameters θ (e.g.
θ = [τ, λ1, . . . , λD] for the ARD kernel) and one can thus consider a Bayesian hierarchical
model:
θ
∼
π(θ)
f|θ
∼
GP(0, kθ)
yi|f, xi, θ
∼
N(f(xi), σ2
n),
i = 1, . . . , n.
(2)
The posterior predictive distribution is straightforward to obtain from the conditioning properties
of multivariate normal distributions. For a new input x∗, we can find the posterior predictive
distribution of the associated response y∗
p(y∗|x∗, D, θ)
=
N(y∗; µθ, σ2
θ)
(3)
µθ
=
kx∗x(Kxx + σ2
nIn)−1y
(4)
σ2
θ
=
σ2
n + k(x∗, x∗) −kx∗x(Kxx + σ2
nIn)−1kxx∗,
(5)
where kxx∗= [k(x1, x∗), . . . , k(xn, x∗)]⊤, kx∗x = k⊤
xx∗and it is understood that the dependence
on θ is through the kernel k = kθ. The computational complexity in prediction stems from
the matrix inversion (Kxx + σ2
nIn)−1. The marginal likelihood (also called model evidence) of
the vector of outputs y = [y1, . . . , yn], is given by p(y|θ) =
R
p(y|f, θ)p(f|θ)df, is obtained by
integrating out the GP evaluations f from the likelihood of the observation model. Maximising
the marginal likelihood over hyperparameters allows for automatic regularisation and hence
for selecting an appropriate model complexity. For a normal observation model in (1), the log
marginal likelihood is available in closed form
log p(y|θ) = −n
2 log(2π) −1
2|Kxx + σ2
nIn| −1
2yT  Kxx + σ2
nIn
−1 y.
(6)

Computing the inverse and determinant in (6) are computationally demanding - moreover,
they need to be computed for every hyperparameter value θ under consideration. To allow for
computational tractability, we will use an approximation of Kxx based on Fourier features (see
section 2.3 and 2.4).
Alternative representations can easily be used such as the primal/dual representations in a closely
related frequentist method, kernel ridge regression (KRR) [26]. In contrast to KRR, optimising
the marginal likelihood as above retains the same computational complexity while providing
uncertainty bounds and automatic regularisation without having to tune a regularisation
hyperparameter. However, the maximisation problem of (6) is non-convex thereby limiting the
chance of finding a global optimum, but instead relying on reasonable local optima [9].
2.2
Random Fourier Feature mappings
The Wiener-Khintchine theorem states that the power spectrum and the autocorrelation function
of a random process constitute a Fourier pair. Given this, random Fourier feature mappings
and similar methodologies [17–19,21,23] appeal to Bochner’s theorem to reformulate the kernel
function in terms of its spectral density.
Theorem 1. (Bochner’s Theorem) A stationary continuous kernel k(xi, xj) = κ(xi −xj) on
Rd is positive definite if and only if κ(δ) is the Fourier transform of a non-negative measure.
Hence, for an appropriately scaled shift invariant complex kernel κ(δ), i.e. for κ(0) = 1, Bochner’s
Theorem ensures that its inverse Fourier Transform is a probability measure:
k(x1, x2) =
Z
Rd eiωT (x1−x2)P(dω).
(7)
Thus, Bochner’s Theorem introduces the duality between stationary kernels and the spectral
measures P(dω). Note that the scale parameter of the kernel, i.e. σ2
f = κ(0) can be trivially
added back into the kernel construction by rescaling. Table 1 shows some popular kernel
functions and their respective spectral densities.

Kernel Name
k(δ)
p(ω)
Squared exponential
e−
(∥δ∥2
2)
2σ
, σ > 0
(2π)−D
2 σD exp(−σ2∥ω∥2
2
2
)
Laplacian
exp(−σ∥δ∥1), σ > 0
  2
π
 2
D QD
i=1
σ
σ2+ω2
i
Mat´ern
21−λ
Γ(λ)
√
(2λ)∥δ∥2
σ
λ
Kλ
√
(2λ)∥δ∥2
σ

2D+λπ
D
2 Γ(λ+D/2)λλ
Γ(λ)σ2λ
  2λ
σ2 + 4π2∥ω∥2
2
−(λ+D/2)
λ > 0, σ > 0
Table 1. Summary table of kernels and their spectral densities
By taking the real part of equation 7 (since we are commonly interested only in real-valued
kernels in the context of GP modelling) and performing standard Monte Carlo integration, we
can derive to a finite-dimensional, reduced rank approximation of the kernel function
k(x1, x2) =
Z
RD eiωT (x1−x2)P(dω)
(8)
= Eω∼P
h
eiωT (x1−x2)i
,
(9)
= Eω∼P

cos(ωT (x1 −x2)) + i sin(ωT (x1 −x2))

(10)
= Eω∼P

cos(ωT (x1 −x2)

(11)
= Eω∼P

cos(ωT x1) cos(ωT x2) + sin(ωT x1) sin(ωT x2)

(12)
≈1
m
m
X
k=1
 cos(ωT
k x1) cos(ωT
k x2) + sin(ωT
k x1) sin(ωT
k x2)

(13)
= 1
m
m
X
k=1
Φk(x1)T Φk(x2)
(14)
where {ωk}m
k=1
i.i.d.
∼P and we denoted
Φk(xl) =

cos(ωT
k xl)
sin(ωT
k xl)

.
For a covariate design matrix X ∈Rn×D (with rows corresponding to data vectors x1, . . . , xn),
and frequency matrix Ω∈Rm×D (with rows coresponding to frequencies ω1, . . . , ωm), we let
Φx =

cos(XΩ⊤) sin(XΩ⊤)

be a n × 2m matrix referred to as the feature map of the dataset.

The estimated covariance matrix can be computed as d
Kxx =
1
mΦxΦxT which has rank at
most 2m. Substituting d
Kxx into (6) now allows rewriting the determinant and the inverse in
terms of the 2m × 2m matrix ΦxT Φx, thereby reducing the computational cost of inference
from O(n3) to O(nm2), where m is the number of Monte Carlo samples/frequencies. Typically,
m ≪n.
In particular, by defining A = ΦxT Φx + m σ2
n
σ2
f I2m where σ2
n is the observation noise variance
and σ2
f = κ(0) is the kernel scale parameter, and taking R = chol(A) to be the Cholesky factor
of A, we first calculate vectors α1, α2 solving the linear systems of equations Rα1 = ΦxT y and
RT α2 = α1. The log marginal likelihood can then be computed efficiently as:
log p(y|θ) = −1
2σ2n
 ∥y∥2 −∥α1∥2
−1
2
X
i
log(R2
ii) + m log
 
mσ2
n
σ2
f
!
−n
2 log(2πσ2
n).
(15)
Additionally, the posterior predictive mean and variance can be estimated as
c
µθ
=
σ2
f
m Φx∗T α2
(16)
c
σ2
θ
=
σ2
n
 
1 +
σ2
f
m ∥α2∥2
!
.
(17)
There are two important disadvantages of standard random Fourier features as proposed by [17]:
firstly, only stationary (shift invariant) kernels can be approximated, and secondly we have
to select a priori a specific class of kernels and their corresponding spectral distributions (e.g.
Table 1). In this paper, we address both of these limitations, with a goal to construct methods
to learn a nonstationary kernel from the data, while preserving the computational efficiency of
random Fourier features.
While we can think about the quantities in (16) as giving approximations to the full GP inference
with a given kernel k, they are in fact performing exact GP calculations for another kernel
ˆk defined using the explicit feature map Φx defined through frequencies sampled from the
spectral measure of k. We can thus think about these feature maps as parametrizing a family of
kernels in their own right and treat frequencies ω1, . . . , ωm as kernel parameters to be optimized,
i.e. learned from the data by maximizing the log marginal likelihood. It should be noted
that dropping the imaginary part of our kernel symmetrizes the spectral measure allowing
us to use any P(dω) – regardless of its symmetry properties, we will still have a real-valued

kernel. In particular, one can use an empirical spectral measure defined by any finite set of
frequencies.
2.3
Nonstationary random Fourier features
Contrary to stationary kernels, which only depend on the lag vector i.e. δ = xi−xj, nonstationary
kernels depend on the inputs themselves. A simple example of a nonstationary kernel would be
the polynomial kernel defined as:
k(x1, x2) = (x⊤
1 x2 + 1)r.
(18)
To extend the stationary random feature mapping to nonstationary kernels, following [12,19,22],
we will need to use a more general spectral characterisation of positive definite functions which
encompasses stationary and nonstationary kernels.
Theorem 2. (Yaglom, 1987 [12,22]) A nonstationary kernel k(x1, x2) is positive definite in Rd
if and only if it has the form:
k(x1, x2) =
Z
RD×RD ei(wT
1 x1−wT
2 x2)µ(dw1, dw2)
(19)
where µ(dw1, dw2) is the Lebesgue-Stieltjes measure associated to some positive semi-definite
function f(w1, w2) with bounded variation.
From the above theorem, a nonstationary kernel can be characterized by a spectral measure
µ(dω1, dω2) on the product space RD × RD. Again, without loss of generality we can assume
that µ is a probability measure. If µ is concentrated along the diagonal, ω1 = ω2, we recover the
spectral representation of stationary kernels in the previous section. However, exploiting this
more general characterisation, we can construct feature mappings for nonstationary kernels.
Just like in the stationary case, we can approximate (19) using Monte Carlo integration. In order
to ensure a valid positive semi-definite spectral density we first have to symmetrize f(ω1, ω2) by
ensuring f(ω1, ω2) = f(ω2, ω1) and including the diagonal components f(ω1, ω1) and f(ω2, ω2)
[23]. We can take a general form of density g on the product space and “symmetrize”:
f(ω1, ω2) = 1
4 (g(ω1, ω2) + g(ω2, ω1) + g(ω1, ω1) + g(ω2, ω2)) .

Once again using Monte Carlo integration we get:
k(x1, x2) = 1
4
Z
RD×RD

ei(ωT
1 x1−ωT
2 x2) + ei(ωT
2 x1−ωT
1 x2) + ei(ωT
1 x1−ωT
1 x2) + ei(ωT
2 x1−ωT
2 x2)
µ(dω1dω2)
= 1
4Eµ

ei(ωT
1 x1−ωT
2 x2) + ei(ωT
2 x1−ωT
1 x2) + ei(ωT
1 x1−ωT
1 x2) + ei(ωT
2 x1−ωT
2 x2)
≈
1
4m
m
X
k=1

ei(xT
1 ω1
k−xT
2 ω2
k) + ei(xT
1 ω2
k−xT
2 ω1
k) + ei(xT
1 ω1
k−xT
2 ω1
k) + ei(xT
1 ω2
k−xT
2 ω2
k)
=
1
4m
m
X
k=1
n
cos(xT
1 ω1
k) cos(xT
2 ω1
k) + cos(xT
1 ω1
k) cos(xT
2 ω2
k)
+ cos(xT
1 ω2
k) cos(xT
2 ω1
k) + cos(xT
1 ω2
k) cos(xT
2 ω2
k)
+ sin(xT
1 ω1
k) sin(xT
2 ω1
k) + sin(xT
1 ω1
k) sin(xT
2 ω2
k)
+ sin(xT
1 ω2
k) sin(xT
2 ω1
k) + sin(xT
1 ω2
k) sin(xT
2 ω2
k)
o
(taking the real part)
=
1
4m
m
X
k=1
Φk(x1)T Φk(x2)
where {(ω1
k, ω2
k)}m
k=1
i.i.d.
∼µ and
Φk(xl) =

cos(xT
l ω1
k) + cos(xT
l ω2
k)
sin(xT
l ω1
k) + sin(xT
l ω2
k)

.
Hence, by denoting Ωl ∈Rm×D (with rows coresponding to frequencies ωl
1, . . . , ωl
m) for l = 1, 2
as before, we obtain the corresponding feature map for the approximated kernel as an n × 2m
matrix
x →Φx =

cos(X(Ω1)T ) + cos(X(Ω2)T ) | sin(X(Ω1)T ) + sin(X(Ω2)T )

(20)
and can be condensed to an identical form as in the stationary case.
d
Kxx =
1
4mΦxΦxT .
(21)
The non-stationarity in equation (21) arises from the product of differing locations x1 and x2
by different frequencies ω1
k, ω2
k, hence making the kernel dependent on the values of x1 and x2
and not only the lag vector. If the frequencies were exactly the same we just revert back to
the stationary case. The complete construction of random Fourier feature approximation is
summarized in the algorithm below.

Algorithm 1 Random Fourier features for nonstationary kernels
Input: spectral measure µ, dataset X, number of frequencies m
Output: Approximation to Kxx
Start Algorithm:
Sample m pairs of frequencies {(ω1
k, ω2
k)}m
k=1
i.i.d.
∼µ giving Ω1 and Ω2
Compute Φx =

cos(X(Ω1)T ) + cos(X(Ω2)T ) | sin(X(Ω1)T ) + sin(X(Ω2)T )

∈Rn×2m
d
Kxx =
1
4mΦxΦxT
End Algorithm
However, just like in the stationary case, we can think about nonstationary Fourier feature maps
as parametrizing a family of kernels and treat frequencies {(ω1
k, ω2
k)}m
k=1 as kernel parameters
to be learned by maximizing the log marginal likelihood, which is an approach we pursue in
this work. Again, symmetrization due to dropping imaginary parts implies that any empirical
spectral measure is valid (there are no constraints on the frequencies).
2.4
On the choice of spectral measure in non-stationary case
Using the characterisation in equation (21) one only requires the specification of the (Lebesgue-
Stieltjes measurable) distribution f(ω1, ω2) in order to construct a nonstationary kernel. This
very general formulation allows us to create the full spectrum encompassing both simple and
highly complex kernels.
In the simplest case, f(ω1, ω2) = f1(ω1)f2(ω2), i.e. it can be a product of popular spectral
densities listed in Table 1. Furthermore, one could consider cases where these individual spectral
densities factorize further across dimensions.
This corresponds to a notion of separability.
In spatio-temporal data, separability can be very useful as it enables interpretation of the
relationship between the covariates as well as computationally efficient estimations and inferences
[27]. Practical implementation is straightforward; consider the classic spatio-temporal setting
with 3 covariates - longitude, latitude and time. When drawing random samples of ωl =
(ω1
l , ω2
l , ω3
l ) where l ∈{1, 2}, we could define the ωi
l to come from different distributions, allowing
us to individually model each input dimension. If the distribution on frequencies are independent

across dimensions then we see that if ω1 = (ω1
1, ω2
1, ω3
1) and ω2 = (ω1
2, ω2
2, ω3
2):
k(x1, x2) =
Z
eiωT
1 x1−iωT
2 x2f(ω1, ω2)dω1dω2
(22)
=
Z
ei(ω1
1x1
1+ω2
1x2
1+ω3
1x3
1−ω1
2x1
2−ω2
2x2
2−ω3
2x3
2)
3
Y
p=1
f(ωp
1, ωp
2)dωp
1dωp
2
(23)
= k1(x1
1, x1
2)k2(x2
1, x2
2)k3(x3
1, x3
2).
(24)
A practical example for spatio-temporal modelling of a nonstationary separable kernel would be
generating a four dimensional (ω1
1, ω1
2, ω2
1, ω2
2) , sample from independent Gaussian distributions
(whose spectral density corresponds to a squared exponential kernel) representing nonstationary
spatial coordinates, and a two dimensional (ω3
1, ω3
2) from a Student-t distribution with 0.5
degrees of freedom (whose spectral density corresponds to a Mat´ern 1/2 kernel or exponential
kernel) representing temporal coordinates.
To move from separable to non-separable, nonstationary kernels one only needs to introduce
some dependence structure within ω1 or ω2 i.e. across feature dimensions, such as for example
using the multivariate normal distribution in RD, in order to prevent the factorization in
equation (22). The correlation structure in these multivariate distributions are what creates the
non-separability.
To create non-separable kernels with different spectral densities along each feature dimension
copulas can be used. An example in a spatial (latitude, longitude feature dimensions) setting
using the Gaussian copula, would involve generating samples for ω1 or ω2 ∈R2 (or both)
from a multivariate normal distribution {ω1
k}m
k=1
i.i.d.
∼N(0, Σ), pass these through the Gaussian
cumulative distribution function, and then used in the quantile function of another distribution
(Λ) i.e. CΛ(ω1) = CDFΛ(CDF −1
N (ω1)). This transformation can also be done using different Λs
along different feature dimensions. Alternative copulas can be readily used, including the popular
Archimedian Copulas: Clayton, Frank and Gumbel [28]. Additionally, mixtures of multivariate
normals can be used [21, 23] to create arbitrarily complex non-separable and nonstationary
kernels. Given sufficient components any probability density function can be approximated to
the desired accuracy.
In this paper, we focus on the most general case where the frequencies {(ω1
k, ω2
k)}m
k=1 are treated

as kernel parameters and are learnt directly from the data by optimising the marginal likelihood,
i.e. they are not associated to any specific family of joint distributions. This approach allows
us to directly learn nonstationary kernels of arbitrary complexity as m increases. However,
a major problem with such a heavily overparametrized kernel is the possibility of overfitting.
Stationary examples of learning frequencies directly from the data [18,29,30] have been known
to overfit despite the regularisation due to working with marginal likelihood. This problem is
further exacerbated in high-dimensional settings, such as those in spatio-temporal mapping with
covariates. In this paper, we include an additional regularisation inspired by dropout [24] which
prevents the co-adaptation of the learnt frequencies ω1, ω2.
2.5
Gaussian dropout regularisation
Dropout [24] is a regularisation technique introduced to mitigate overfitting in deep neural
networks. In its simplest form, dropout involves setting features/matrix entries to zero with
probability q = 1 −p, i.e. according to a Bernoulli(p) for each feature. The main motivation
behind the algorithm is to prevent co-adaptation by forcing features to be robust and rely on
population behaviour. This prevents individual features from overfitting to idiosyncrasies of the
data.
Using standard dropout, where zeros are introduced into the frequencies {(ω1
k, ω2
k)}m
k=1 can be
problematic due to the trigonometric transformations in the projected features. An alternative
to dropout that has been shown to be just as effective if not better is Gaussian dropout
[24,31]. Regularisation via Gaussian dropout involves augmenting our sample distribution as
{(ω1
k, ω2
k)η}m
k=1 = N(1, σ2
p) ⊙{(ω1
k, ω2
k)}m
k=1. The addition of noise through N(1, σ2
p) ensures
unbiased estimates of the covariance matrix i.e E[{(ω1
k, ω2
k)η}m
k=1] = E[{(ω1
k, ω2
k)}m
k=1] (see figure
1). As with dropout, this approach prevented our population Monte Carlo sample from co-
adapting, and ensured that the learnt frequencies are robust and not overfitting noise in the
data. An additional benefit of this procedure over improving generalisation error and preventing
overfitting was to speed up the convergence of gradient descent optimisers through escaping
saddle points more effectively [32]. The noise parameter σp defines the degree of regularisation
and is a hyperparameter that needs to be tuned. However, we found in practice when coupled

with an early stopping procedure, learning the frequencies is robust to sensible choices of
σp.
3
Results
3.1
Google daily high stock price
To demonstrate the use of the developed method and the utility of nonstationary modelling, we
consider time series data of the daily high stock price of Google spanning 3295 days from 19th
August 2004 to 20th September 2017. We set x ∈{1, . . . , 3295} and y = log(Stockhigh). For the
stationary case we use vanilla random Fourier features [17,18] with the squared exponential
kernel (Gaussian spectral density) and m = 600 fixed frequencies. For the nonstationary case we
use m = 300 frequencies for each ω1 and for ω2. We performed a sensitivity analysis to check that
no improvements in either the log marginal likelihood or testing error resulted from using more
features. Cross-validation was performed using a 70 −30 training-testing split averaged over 20
independent runs and testing performance evaluated via the mean squared error and correlation.
Optimisation of the log marginal likelihood was performed using ADAM [33] gradient descent in
TensorFlow [34] with early stopping and patience [35].
Figure 2 (top left) shows the comparison in the optimisation paths of the negative log marginal
likelihood between the two methods. It is clear that the nonstationary approach reaches a lower
minima than the vanilla random Fourier features approach. This is also mirrored in the testing
accuracy over the 20 independent runs where our approach achieves a mean squared error and
correlation of 3.29 × 10−5 and 0.999, while the vanilla Fourier features approach achieves a mean
squared error and correlation of 5.69 × 10−5 and 0.987. Of note is the impact of our Gaussian
dropout regularisation, which, through the injection of noise, appears to converge faster and
avoid plateaus. This is entirely in keeping with previous experiences using dropout variants [31]
and highlights an added benefit over using only ridge (weight decay) regularisation.
Figure 3 (top) shows the overall fits compared to the raw data. Both methods appear to fit the
data very well, as reflected in the testing statistics, but when examining a zoomed-in transect

it is clear that the learnt nonstationary features fit the data better than the vanilla random
features by allowing variable degree of smoothness in time. The combination of nonstationarity
and kernel flexibility allowed us to learn a much better characterisation of the data patterns
without overfitting. The covariance matrix comparisons (Figure 3 bottom) further highlight this
point where the learnt nonstationary covariance matrix shares some similarities with the vanilla
random features covariance matrix, such as the concentration on the diagonal, but exhibits a
much greater degree of texture. The histograms in Figure 3 provide another perspective on the
covariance structure, where the vanilla features are by design Gaussian distributed, but learnt
nonstationary frequencies are far from Gaussian (Kolmogorov-Smirnov test p-value< 10−16)
exhibiting skewness and heavy tails. Additionally, the differences between the learnt frequencies
ω1 and ω2 show that, not only is the learnt kernel far from Gaussian, but that it is indeed
also nonstationary. This simple example also highlights the potential defficiencies of choosing
kernels/frequencies a priori.
3.2
Spatial temperature anomaly for East Africa in 2016
We next consider MOD11A2 Land Surface Temperature (LST) 8-day composite data [36], gap
filled for cloud cover images [5] and averaged to a synoptic yearly mean for 2016. To replicate
common situations for spatial mapping, such as interpolation from sparse remote sensed sites or
cluster house hold survey locations [25] we randomly sample 4000 LST locations (only ∼4% of the
total) from the East Africa region (see Figures 4 and 5). We set x ∈R2 = {Latitude, Longitude}
i.e. using only the spatial coordinates as covariates, and use the LST temperature anomaly as
the response. We apply our nonstationary approach, learning m = 600 frequencies for ω1 and ω2
each. Cross validation was evaluated over all pixels excluding the training set (∼83, 000) and
averaged over 10 independent runs with testing performance evaluated via the mean squared
error and correlation. Our final performance estimates were 4.23 and 0.91 for the mean squared
error and correlation respectively. Figure 4 shows our predicted surface (left) compared to
the actual data (right). Our model shows strong correspondence to the underlying data and
highlights the suitability of using our approach in settings where no relevant covariates exist
outside of the spatial coordinates. Figure 5 shows 3 randomly sampled points and the covariance
patterns around those points. For comparison Figure 6 shows the equivalent plot when using a

stationary squared exponential kernel. In stark contrast to the stationary covariance function,
which has an identical structure for all three points, the nonstationary kernel shows considerable
heterogeneity in both patterns and shapes. Interestingly the learnt lengthscale/bandwidth
seems to be much smaller in the stationary case than the nonstationary case, we hypothesise
that this is due to the inability of the stationary kernel to learn the rich covariance structure
needed to accurately model temperature anomaly. Intuitively, nonstationarity allows locally
dependent covariance structures which conform to the properties of a particular location and
imply (on average) larger similarity of nearby outputs and better generalisation ability. In
contrast, stationary kernels are trying to fit one covariance structure to all locations and as a
result end up with a much shorter lengthscale as it needs to apply to all directions from all
locations. Our results are in concordance with other studies showing that temperature anomaly
data is nonstationary [19, 23, 37]. This interpolation problem can readily be expanded into
multiple dimensions including time and other covariates.
4
Discussion
We have shown that nonstationary kernels of arbitrary complexity are as easy to model as
stationary ones, and can be learnt with sufficient efficiency to be applicable to datasets of
all sizes.
The qualitative superiority of predictions when using nonstationary kernels has
previously been noted [11]. In many applications, such as in epidemiology where data can be
noisy, generalisation accuracy is not the only measure of model performance, and there is a
need for models that conform to known biological constraints and external field data. The
flexibility of nonstationary kernels allows for more plausible realities to be modelled without
the assumption of stationarity limiting the expressiveness of the predictions. It has also been
noted that while nonstationary GPs give more sensible results than stationary GPs, they often
show little generalisation improvement [11]. For the examples in this work we show clear
improvements in generalisation accuracy when using nonstationary kernels. We conjecture that
the differences in generalisation performance are likely due to the same reasons limiting neural
network performance a decade ago [38] - namely, a combination of small, poor quality data and
a lack of generality in the underlying specification. Given more generalised specifications, such

as those introduced in this paper, coupled with the current trend of increasing quantities of
high quality data [39] we believe nonstationary approaches will be more and more relevant in
spatio-temporal modelling.
There has long been codes of practice on which kernel to use on which spatial dataset [10]
based on a priori assumptions about the roughness of the underlying process.
Using the
approach introduced in this paper, ad hoc choices of kernel and decisions on stationarity
versus nonstationarity may no longer be needed as it may be possible to learn the kernel
automatically from the data. For example, our approach can be easily modified to vary the
degree of nonstationarity according to patterns found in the data.
In this work we have focused on optimising the marginal likelihood in Gaussian Process regression
and added extra regularisation via Gaussian dropout. However, for non-Gaussian observation
models the marginal likelihood cannot be obtained in a closed form. In these settings, one
may resort to frequentist methods instead and resort to variational [30], approximate [40,41]
or suitable MCMC [42] approaches in order to provide uncertainty measures. For very large
models with non-Gaussian observation models, stochastic gradient descent in mini-batches [43]
or stochastic gradient Bayesian methods [44] can be used.
The matrix Φ that results from the Fourier feature expansion can be thought of as a hidden
layer in a single layer neural network. This formulation explicitly connects the random Fourier
feature approach and single layer neural networks using learnable (or random) nodes and specific
trigonometric activation functions. Our approach can therefore be used in deep learning settings
while retaining an explicit link to kernel methods and their interpretability [45].

5
Figures
241.0
241.5
242.0
242.5
243.0
243.5
244.0
0
20
40
60
80
100
Matrix Norm
Figure 1. Histogram of the Euclidean norm of a covariance matrix ΦΦT with Gaussian dropout of
σp = 0.05. The black line is the norm of ΦΦT without noise

Figure 2. (top left) Log Marginal likelihood (Y-axis), optimisation gradient update count (X-axis),
vanilla random features (blue), proposed approach (red); (top right) Histogram of learnt ω1 for our
nonstationary approach; (bottom left) Histogram of learnt ω2 for our nonstationary approach; (bottom
right) Histogram of ω2 for vanilla random Fourier features

Figure 3. (top) Log daily-high Google stock price (Y-axis), days since 19th August 2004 (X-axis).
Vanilla random features (blue) our proposed approach(red), actual data (black), with a zoomed in
transect (purple box); (bottom left) Image of covariance matrix for our nonstationary method; (bottom
right) Image of covariance matrix for vanilla random Fourier features

Figure 4. Predicted (left) verses actual (right) temperature anomaly maps

Figure 5. Covariance matrix images for 3 random points showing different covariance structures due
to nonstationarity

Figure 6. Covariance matrix images for 3 random points showing identical covariance structures for all
locations due to stationarity

Author Contributions
Conceived of and designed the research: SB, DS, SF, JFT. Drafted the manuscript: SB, DS, SF,
JFT. Conducted the analyses: SB,JFT. Supported the analyses: SB, DS, SF, JFT.All authors
discussed the results and contributed to the revision of the final manuscript.
Funding Statement
SB is supported by the MRC outbreak centre and the Bill and Melinda Gates Foundation
[OPP1152978].
6
References
References
1. A method for spatial–temporal forecasting with an application to real estate prices.
International Journal of Forecasting, 16(2):229–246, 4 2000.
2. Veronica J. Berrocal, Adrian E. Raftery, Tilmann Gneiting, Veronica J. Berrocal, Adrian E.
Raftery, and Tilmann Gneiting. Combining Spatial Statistical and Ensemble Information
in Probabilistic Weather Forecasts. Monthly Weather Review, 135(4):1386–1402, 4 2007.
3. Alfred Stein, Freek Van der Meer, and Ben Gorte, editors. Spatial Statistics for Remote
Sensing, volume 1 of Remote Sensing and Digital Image Processing. Springer Netherlands,
Dordrecht, 2002.
4. D.J. Daniel J J Weiss, Samir Bhatt, Bonnie Mappin, Thomas P P T.P. Van Boeckel,
David L L D.L. Smith, S.I. Simon I I Hay, and Peter W W P.W. Gething. Air temperature
suitability for Plasmodium falciparum malaria transmission in Africa 2000-2012: a high-
resolution spatiotemporal prediction. Malaria journal, 13(1):171, 1 2014.

5. Daniel J D.J. Weiss, Peter M P.M. Atkinson, Samir Bhatt, Bonnie Mappin, Simon I S.I.
Hay, and Peter W P.W. Gething. An effective approach for gap-filling continental scale
remotely sensed time-series. ISPRS journal of photogrammetry and remote sensing :
official publication of the International Society for Photogrammetry and Remote Sensing
(ISPRS), 98:106–118, 12 2014.
6. S. Bhatt, D.J. J J Weiss, E. Cameron, D. Bisanzio, B. Mappin, U. Dalrymple, K.E. E E
Battle, C.L. L L Moyes, A. Henry, P.A. A A Eckhoff, E.A. A A Wenger, O. Bri¨et, M.A.
A A Penny, T.A. A A Smith, A. Bennett, J. Yukich, T.P. P P Eisele, J.T. T T Griffin,
C.A. A A Fergus, M. Lynch, F. Lindgren, J.M. M M Cohen, C.L.J. L J L J Murray,
D.L. L L Smith, S.I. I I Hay, R.E. E E Cibulskis, and P.W. W W Gething. The effect
of malaria control on Plasmodium falciparum in Africa between 2000 and 2015. Nature,
526(7572):207–211, 9 2015.
7. Samir Bhatt, Peter W P.W. Gething, Oliver J O.J. Brady, J.P. Jane P Messina, Andrew
W A.W. Farlow, Catherine L C.L. Moyes, J.M. John M Drake, J.S. John S Brownstein,
Anne G A.G. Hoen, Osman Sankoh, M.F. Monica F Myers, Dylan B D.B. George,
Thomas Jaenisch, G.R. William Wint, C.P. Cameron P Simmons, Thomas W T.W. Scott,
Jeremy J.J. Farrar, Simon I S.I. Hay, G R William Wint, C.P. Cameron P Simmons,
Thomas W T.W. Scott, Jeremy J.J. Farrar, and Simon I S.I. Hay. The global distribution
and burden of dengue. Nature, 496(7446):504–7, 4 2013.
8. Simon I S.I. Hay, K.E. Katherine E Battle, D.M. David M Pigott, D.L. David L Smith,
Catherine L C.L. Moyes, Samir Bhatt, J.S. John S Brownstein, Nigel Collier, M.F.
Monica F Myers, Dylan B D.B. George, Peter W P.W. Gething, others, and Peter W P.W.
Gething. Global mapping of infectious disease. Philosophical transactions of the Royal
Society of London. Series B, Biological sciences, 368(1614):20120250, 3 2013.
9. Carl Edward Rasmussen and Christopher K I Williams. Gaussian processes for machine
learning, volume 1. MIT press Cambridge, 2006.
10. Peter Diggle and PJ Ribeiro. Model-based Geostatistics. Springer, New York, 2007.
11. Christopher J. Paciorek and Mark J. Schervish. Spatial modelling using a new class of

nonstationary covariance functions. Environmetrics, 17(5):483–506, 8 2006.
12. Marc G Genton. Classes of kernels for machine learning: a statistics perspective. Journal
of machine learning research, 2(Dec):299–312, 2001.
13. Charles A. Micchelli, Yuesheng Xu, and Haizhang Zhang. Universal kernels. J. Mach.
Learn. Res., 7:2651–2667, December 2006.
14. Joaquin Qui˜nonero-Candela and Carl Edward Rasmussen. A unifying view of sparse
approximate Gaussian process regression. The Journal of Machine Learning Research,
6(Dec):1939–1959, 2005.
15. Edward Snelson and Zoubin Ghahramani. Variable noise and dimensionality reduction
for sparse Gaussian processes. arXiv preprint arXiv:1206.6873, 2012.
16. Finn Lindgren, H˚avard Rue, and Johan Lindstr¨om. An explicit link between Gaussian
fields and Gaussian Markov random fields: the stochastic partial differential equation
approach. Journal of the Royal Statistical Society: Series B (Statistical Methodology),
73(4):423–498, 2011.
17. A Rahimi and B Recht. Random features for large-scale kernel machines. Advances in
neural information processing, 2008.
18. Miguel L´azaro-Gredilla, Joaquin Qui˜nonero Candela, Carl Edward Rasmussen, and
An´ıbal R. Figueiras-Vidal. Sparse spectrum gaussian process regression. Journal of
Machine Learning Research, 11:1865–1881, 2010.
19. Yves-Laurent Kom Samo and Stephen Roberts. Generalized Spectral Kernels. 2015.
20. Andrew Wilson and Ryan Adams. Gaussian process kernels for pattern discovery and
extrapolation. In Proceedings of the 30th International Conference on Machine Learning
(ICML-13), pages 1067–1075, 2013.
21. Zichao Yang, Andrew Wilson, Alex Smola, and Le Song. A la Carte – Learning Fast
Kernels, 2015.

22. A. M. Yaglom. Correlation Theory of Stationary and Related Random Functions. Springer
Series in Statistics. Springer New York, New York, NY, 1987.
23. Sami Remes, Markus Heinonen, and Samuel Kaski. Non-Stationary Spectral Kernels.
[Accepted to NIPS 2017] arXiv preprint arXiv:1705.08736, 2017.
24. Nitish Srivastava, Geoffrey Hinton, Alex Krizhevsky, Ilya Sutskever, and Ruslan Salakhut-
dinov. Dropout: A Simple Way to Prevent Neural Networks from Overfitting. Journal of
Machine Learning Research, 15:1929–1958, 2014.
25. Samir Bhatt, Ewan Cameron, Seth R Flaxman, Daniel J Weiss, David L Smith, and
Peter W Gething. Improved prediction accuracy for disease risk mapping using Gaussian
process stacked generalization. Journal of the Royal Society, Interface, 14(134):20170520,
sep 2017.
26. Trevor Hastie, Robert Tibshirani, and J H Friedman. The elements of statistical learning.
Springer, 2009.
27. Barbel. Finkenstadt, Leonhard. Held, and Valerie. Isham. Statistical methods for spatio-
temporal systems. Chapman & Hall/CRC, 2007.
28. Christian Genest and Jock MacKay. The Joy of Copulas: Bivariate Distributions with
Uniform Marginals. The American Statistician, 40(4):280, 11 1986.
29. Yarin Gal and Richard Turner.
Improving the Gaussian Process Sparse Spectrum
Approximation by Representing Uncertainty in Frequency Inputs. Proceedings of the 32nd
International Conference on Machine Learning (ICML-15), 2015.
30. Linda S L Tan, Victor M H Ong, David J Nott, and Ajay Jasra. Variational inference for
sparse spectrum Gaussian process regression. arXiv preprint arXiv:1306.1999, 2013.
31. Pierre Baldi and Peter J Sadowski. Understanding Dropout, 2013.
32. Jason D Lee, Ioannis Panageas, Georgios Piliouras, Max Simchowitz, Michael I Jordan,
and Benjamin Recht. First-order Methods Almost Always Avoid Saddle Points. arXiv
preprint arXiv:1710.07406, 2017.

33. Diederik P Kingma and Jimmy Ba. Adam: A Method for Stochastic Optimization. arXiv
preprint arXiv:1412.6980, 2014.
34. Mart´ın Abadi, Ashish Agarwal, Paul Barham, Eugene Brevdo, Zhifeng Chen, Craig
Citro, Greg S. Corrado, Andy Davis, Jeffrey Dean, Matthieu Devin, Sanjay Ghemawat,
Ian Goodfellow, Andrew Harp, Geoffrey Irving, Michael Isard, Yangqing Jia, Rafal
Jozefowicz, Lukasz Kaiser, Manjunath Kudlur, Josh Levenberg, Dan Mane, Rajat Monga,
Sherry Moore, Derek Murray, Chris Olah, Mike Schuster, Jonathon Shlens, Benoit
Steiner, Ilya Sutskever, Kunal Talwar, Paul Tucker, Vincent Vanhoucke, Vijay Vasudevan,
Fernanda Viegas, Oriol Vinyals, Pete Warden, Martin Wattenberg, Martin Wicke, Yuan
Yu, and Xiaoqiang Zheng. TensorFlow: Large-Scale Machine Learning on Heterogeneous
Distributed Systems. 3 2016.
35. Lutz Prechelt. Early Stopping - But When? pages 55–69. Springer, Berlin, Heidelberg,
1998.
36. Zhengming Wan, Yulin Zhang, Qincheng Zhang, and Zhao-liang Li. Validation of the
land-surface temperature products retrieved from Terra Moderate Resolution Imaging
Spectroradiometer data. Remote Sensing of Environment, 83(1-2):163–180, 11 2002.
37. Zhaohua Wu, Norden E Huang, Steven R Long, and Chung-Kang Peng. On the trend,
detrending, and variability of nonlinear and nonstationary time series. Proceedings of the
National Academy of Sciences of the United States of America, 104(38):14889–94, 9 2007.
38. Yann LeCun, Yoshua Bengio, and Geoffrey Hinton. Deep learning. Nature, 521(7553):436–
444, 5 2015.
39. Trends in big data analytics. Journal of Parallel and Distributed Computing, 74(7):2561–
2573, 7 2014.
40. H˚avard Rue, Sara Martino, and Nicolas Chopin. Approximate Bayesian inference for
latent Gaussian models by using integrated nested Laplace approximations. Journal of
the Royal Statistical Society: Series B (Statistical Methodology), 71(2):319–392, 2009.
41. Thomas P Minka. Expectation propagation for approximate Bayesian inference. pages

362–369, 2001.
42. Bob Carpenter, Bob Carpenter, Daniel Lee, Marcus A. Brubaker, Allen Riddell, Andrew
Gelman, Ben Goodrich, Jiqiang Guo, Matt Hoffman, Michael Betancourt, and Peter Li.
Stan: A Probabilistic Programming Language.
43. Yoshua Bengio. Practical Recommendations for Gradient-Based Training of Deep Archi-
tectures. pages 437–478. Springer Berlin Heidelberg, 2012.
44. Tianqi Chen, Emily Fox, and Carlos Guestrin. Stochastic Gradient Hamiltonian Monte
Carlo, 1 2014.
45. Jaehoon Lee, Yasaman Bahri, Roman Novak, Samuel S. Schoenholz, Jeffrey Pennington,
and Jascha Sohl-Dickstein. Deep Neural Networks as Gaussian Processes. 10 2017.
